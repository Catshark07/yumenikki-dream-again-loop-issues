[gd_scene load_steps=35 format=4 uid="uid://ccmtase1d8qad"]

[ext_resource type="Script" uid="uid://b1ofr4umso5jf" path="res://src/systems/scenes/game/game_scene.gd" id="1_sg2j5"]
[ext_resource type="PackedScene" uid="uid://ryhx8o46er7i" path="res://src/player/2D/madotsuki/madotsuki.tscn" id="2_0vwvw"]
[ext_resource type="Texture2D" uid="uid://b4gjcclvhphd7" path="res://src/images/panorama/earth.png" id="2_k5lwt"]
[ext_resource type="Shader" uid="uid://hg6wywtqrlha" path="res://src/shaders/masks/additive.gdshader" id="2_kfc05"]
[ext_resource type="Script" uid="uid://b4b3kjcm65mv6" path="res://src/systems/audio/bgm.gd" id="2_wwvai"]
[ext_resource type="AudioStream" uid="uid://dxkjhkg5y4lav" path="res://src/audio/amb/amb_space_mission_control.ogg" id="3_7bfsl"]
[ext_resource type="AudioStream" uid="uid://bm7y6qujkfypq" path="res://src/audio/bgm/madoxy_46.ogg" id="3_c4hgi"]
[ext_resource type="PackedScene" uid="uid://c8bnpo28a373g" path="res://src/systems/camera/camera.tscn" id="5_50osm"]
[ext_resource type="Shader" uid="uid://hqppcc6e4xw2" path="res://src/shaders/panorama/lens_flare.gdshader" id="6_18jn3"]
[ext_resource type="Texture2D" path="res://src/images/overlay/flare.png" id="7_h623d"]
[ext_resource type="Shader" uid="uid://brem0ley6fcra" path="res://src/shaders/panorama/depth_additive.gdshader" id="10_bg4cs"]
[ext_resource type="Script" uid="uid://bptlrkdn0tpua" path="res://src/systems/components/overrides/wiggle.gd" id="16_54kc8"]
[ext_resource type="TileSet" uid="uid://du0rp0mcyc03" path="res://src/levels/_dream/glass_cubes/road_tileset.tres" id="16_486hh"]
[ext_resource type="TileSet" uid="uid://chq6llr7r6c7s" path="res://src/levels/_dream/glass_cubes/lamp_tileset.tres" id="16_cby7n"]
[ext_resource type="PackedScene" path="res://src/levels/door.tscn" id="18_7vvwf"]
[ext_resource type="Texture2D" uid="uid://dejtiqb6tw5aq" path="res://src/levels/_dream/glass_cubes/sprites/glass_tilemap.png" id="18_j3nug"]
[ext_resource type="Script" uid="uid://0v2nidb8jsha" path="res://src/systems/event/event_interface.gd" id="19_kf87u"]
[ext_resource type="Script" uid="uid://vk574kc3l7av" path="res://src/systems/event/audio/play_sound.gd" id="20_myjgy"]
[ext_resource type="AudioStream" uid="uid://bipehuwb1yaul" path="res://src/audio/se/se_door_open-1.wav" id="21_tbxjv"]
[ext_resource type="Script" uid="uid://c1od80bn28h0l" path="res://src/systems/event/sequence/sequence_interface.gd" id="22_3mapr"]
[ext_resource type="Texture2D" uid="uid://c3byfy6b7jo86" path="res://src/levels/_dream/upper_abyss/sprites/closed.png" id="23_orxyj"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_dlbi4"]
shader = ExtResource("6_18jn3")
shader_parameter/uv_rotation_speed = 1.155
shader_parameter/uv_rotation_pivot = Vector2(0.5, 0.5)
shader_parameter/uv_offset = Vector2(0, 0)
shader_parameter/offset_strength = 1.0
shader_parameter/transparency = 0.65

[sub_resource type="ShaderMaterial" id="ShaderMaterial_rtlck"]
shader = ExtResource("10_bg4cs")
shader_parameter/offset_strength = 0.235
shader_parameter/transparency = 0.0

[sub_resource type="Curve" id="Curve_l6xdo"]
_data = [Vector2(0, 0), 0.0, 0.0, 0, 0, Vector2(0.0632911, 0.463917), 0.0, 0.0, 0, 0, Vector2(0.177215, 0.268041), 0.0, 0.0, 0, 0, Vector2(0.396625, 0.752577), 0.0, 0.0, 0, 0, Vector2(0.523207, 0.505155), 0.0, 0.0, 0, 0, Vector2(0.763713, 0.762887), 0.0, 0.0, 0, 0, Vector2(1, 0), -2.70508, 0.0, 0, 0]
point_count = 7

[sub_resource type="CurveTexture" id="CurveTexture_4lvth"]
curve = SubResource("Curve_l6xdo")

[sub_resource type="ParticleProcessMaterial" id="ParticleProcessMaterial_423sj"]
particle_flag_rotate_y = true
emission_shape_scale = Vector3(1, 1, 0)
emission_shape = 3
emission_box_extents = Vector3(14, 6, 0)
angle_min = -168.6
angle_max = 180.0
direction = Vector3(1, 1, -1)
flatness = 1.0
initial_velocity_max = 1.0
angular_velocity_min = 50.0
angular_velocity_max = 200.0
gravity = Vector3(0, 0, 0)
scale_min = 0.2
scale_curve = SubResource("CurveTexture_4lvth")

[sub_resource type="BoxMesh" id="BoxMesh_dyepi"]
lightmap_size_hint = Vector2i(14, 21)

[sub_resource type="Sky" id="Sky_n0873"]

[sub_resource type="Environment" id="Environment_ojpy2"]
background_mode = 5
background_color = Color(1, 1, 1, 1)
background_energy_multiplier = 0.0
sky = SubResource("Sky_n0873")
ambient_light_source = 2
ambient_light_color = Color(0.0695457, 0.120319, 0.236275, 1)
fog_light_color = Color(0, 0, 0.258824, 1)
fog_sun_scatter = 0.15
fog_density = 0.0
adjustment_brightness = 1.34
adjustment_contrast = 1.74
adjustment_saturation = 8.0

[sub_resource type="ShaderMaterial" id="ShaderMaterial_flxpe"]
shader = ExtResource("2_kfc05")
shader_parameter/transparency = 0.0

[sub_resource type="TileSetAtlasSource" id="TileSetAtlasSource_e41mc"]
texture = ExtResource("18_j3nug")
texture_region_size = Vector2i(118, 154)
0:0/0 = 0

[sub_resource type="TileSet" id="TileSet_plc7n"]
tile_shape = 1
tile_size = Vector2i(118, 58)
sources/0 = SubResource("TileSetAtlasSource_e41mc")

[sub_resource type="Resource" id="Resource_effhv"]
script = ExtResource("20_myjgy")
sound = ExtResource("21_tbxjv")
volume = 0.0
pitch = 1.0

[sub_resource type="Resource" id="Resource_bjrq6"]
script = ExtResource("22_3mapr")
order = Array[ExtResource("19_kf87u")]([SubResource("Resource_effhv")])

[node name="glass_cubes" type="Node"]
script = ExtResource("1_sg2j5")

[node name="AMB" type="Node" parent="."]
script = ExtResource("2_wwvai")
music_bus = 1
stream = ExtResource("3_7bfsl")
vol = 8.0
metadata/_custom_type_script = "uid://b4b3kjcm65mv6"

[node name="BGM" type="Node" parent="."]
script = ExtResource("2_wwvai")
stream = ExtResource("3_c4hgi")
pitch = 0.85

[node name="screen_overlay" type="CanvasLayer" parent="."]
layer = 10

[node name="flare" type="TextureRect" parent="screen_overlay"]
material = SubResource("ShaderMaterial_dlbi4")
offset_left = -54.0
offset_top = -87.0
offset_right = 775.0
offset_bottom = 387.0
texture = ExtResource("7_h623d")

[node name="panorama (bottom_layer)" type="CanvasLayer" parent="."]
layer = -30

[node name="panorama" type="TextureRect" parent="panorama (bottom_layer)"]
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
offset_right = 160.0
offset_bottom = 90.0
grow_horizontal = 2
grow_vertical = 2
texture = ExtResource("2_k5lwt")

[node name="panorama (middle_layer)" type="CanvasLayer" parent="."]
layer = -25

[node name="renderer" type="SubViewportContainer" parent="panorama (middle_layer)"]
texture_repeat = 2
material = SubResource("ShaderMaterial_rtlck")
offset_right = 480.0
offset_bottom = 270.0

[node name="subvp" type="SubViewport" parent="panorama (middle_layer)/renderer"]
transparent_bg = true
handle_input_locally = false
size = Vector2i(480, 270)
render_target_update_mode = 4

[node name="GPUParticles3D" type="GPUParticles3D" parent="panorama (middle_layer)/renderer/subvp"]
cast_shadow = 0
amount = 50
lifetime = 5.0
preprocess = 10.0
process_material = SubResource("ParticleProcessMaterial_423sj")
draw_pass_1 = SubResource("BoxMesh_dyepi")

[node name="Camera3D" type="Camera3D" parent="panorama (middle_layer)/renderer/subvp"]
transform = Transform3D(1, 0, 0, 0, 0.939693, -0.34202, 0, 0.34202, 0.939693, 0.19, -0.855, 9.54)
environment = SubResource("Environment_ojpy2")
current = true
fov = 45.0
near = 0.037

[node name="DirectionalLight3D" type="DirectionalLight3D" parent="panorama (middle_layer)/renderer/subvp"]
transform = Transform3D(1, 0, 0, 0, -4.37114e-08, -1, 0, 1, -4.37114e-08, 0, 17, -4)
light_color = Color(0.825192, 0.937171, 0.999934, 1)
light_energy = 0.338
light_bake_mode = 0
directional_shadow_mode = 0

[node name="camera" parent="." instance=ExtResource("5_50osm")]

[node name="camera_handler" parent="camera" index="0" node_paths=PackedStringArray("target")]
target = NodePath("../../_/Sally")

[node name="camera_camera_handler_camera#WiggleComponent" type="Node" parent="camera/camera_handler/marker/camera/components_receiver" index="0"]
script = ExtResource("16_54kc8")
ignore_rotation = false

[node name="_" type="Node2D" parent="."]
y_sort_enabled = true

[node name="Sally" parent="_" instance=ExtResource("2_0vwvw")]
position = Vector2(241, 119)

[node name="sound_player" parent="_/Sally/footstep_manager" index="0"]
muted = true

[node name="sound_player" parent="_/Sally" index="14"]
muted = true

[node name="lamps_b" type="TileMapLayer" parent="_"]
z_index = -2
y_sort_enabled = true
material = SubResource("ShaderMaterial_flxpe")
tile_map_data = PackedByteArray("AAACAAMAAQABAAAAAAAEAAcAAQABAAAAAAAFAAkAAQAAAAAAAAAGAAsAAQAAAAAAAAADAAUAAQAAAAAAAAAAAAMAAQABAAAAABD//wUAAQAAAAAAABD+/wcAAQAAAAAAABD9/wkAAQABAAAAABAFAA8AAQABAAAAABAEABEAAQAAAAAAABADABEAAQABAAAAAAACAA8AAQAAAAAAAAD+/xEAAQAAAAAAABA=")
tile_set = ExtResource("16_cby7n")

[node name="glass_cubes" type="TileMapLayer" parent="_"]
y_sort_enabled = true
tile_map_data = PackedByteArray("AAAJAA4AAAAAAAAAAAAJAA8AAAAAAAAAAAABAP3/AAAAAAAAAAAAAAsAAAAAAAAAAAABAAwAAAAAAAAAAAAEAA8AAAAAAAAAAAAEAAwAAAAAAAAAAAADAAsAAAAAAAAAAAAEAA4AAAAAAAAAAAADAP7/AAAAAAAAAAD9/wMAAAAAAAAAAAD9/wQAAAAAAAAAAAD+/wEAAAAAAAAAAAD+/wIAAAAAAAAAAAAHAAQAAAAAAAAAAAAHAAkAAAAAAAAAAAAIAAcAAAAAAAAAAAAIAAgAAAAAAAAAAAAEAAEAAAAAAAAAAAAFAAIAAAAAAAAAAAABAP7/AAAAAAAAAAA=")
tile_set = SubResource("TileSet_plc7n")

[node name="roads" type="TileMapLayer" parent="_"]
z_index = -1
y_sort_enabled = true
material = SubResource("ShaderMaterial_flxpe")
tile_map_data = PackedByteArray("AAAAAAUAAAABAAIAAAABAAMAAAAAAAMAADABAAQAAAABAAIAAAACAAQAAAABAAIAABACAAUAAAABAAIAABADAAYAAAABAAIAABADAAcAAAABAAIAABAEAAgAAAABAAIAABAEAAkAAAABAAIAABAAAAYAAAABAAIAAAD//wcAAAABAAIAAAD//wgAAAABAAIAAAAFAAoAAAABAAIAABAFAAsAAAABAAIAABD+/wkAAAABAAIAAAD9/wsAAAABAAIAAAD+/woAAAABAAIAAAD+/w4AAAAAAAMAAAD9/w0AAAABAAIAABD9/wwAAAACAAEAAAD+/w0AAAAAAAMAACAGAAwAAAABAAIAABAGAA0AAAABAAIAABAGAA8AAAABAAEAAAAGABAAAAABAAIAAAAFABEAAAABAAIAAAAFABIAAAABAAIAAAAEABMAAAABAAIAAAAEABQAAAAAAAMAAAADABMAAAABAAEAABADABIAAAABAAEAABACABEAAAABAAEAABACABAAAAABAAIAABABABEAAAAAAAMAACACABIAAAABAAIAABACABMAAAABAAIAABADABQAAAABAAIAABADABUAAAABAAIAABABAA8AAAAAAAMAADABABIAAAABAAIAAAAAABMAAAABAAIAAAABABAAAAABAAIAAAAAABIAAAABAAIAAAD//w4AAAABAAIAABD//w8AAAABAAIAABAAABAAAAABAAIAABAAABEAAAABAAMAAAD//xMAAAABAAEAAAD//xQAAAAAAAMAAAD+/xMAAAACAAEAAAD//xIAAAABAAIAAAAFABQAAAABAAIAAAAGABEAAAABAAIAAAAEABUAAAABAAIAAAAFABMAAAABAAIAAAAGABIAAAABAAIAAAAEABYAAAAAAAMAAAAHABAAAAABAAMAAAAHAA4AAAABAAEAABAHAA8AAAACAAEAABAAABQAAAAAAAMAAAA=")
tile_set = ExtResource("16_486hh")

[node name="lamps_f" type="TileMapLayer" parent="_"]
y_sort_enabled = true
material = SubResource("ShaderMaterial_flxpe")
tile_map_data = PackedByteArray("AAACAAQAAQABAAAAABADAAYAAQABAAAAABAEAAgAAQAAAAAAABAFAAoAAQAAAAAAABAGAAwAAQAAAAAAABD+/woAAQABAAAAAAD//wgAAQABAAAAAAAAAAYAAQABAAAAAAABAAQAAQABAAAAAAAEABUAAQABAAAAAAAFABMAAQAAAAAAAAAGABEAAQAAAAAAAAAHAA8AAQABAAAAAAAAABAAAQABAAAAAAD//w4AAQAAAAAAAAD9/w0AAQAAAAAAABADABUAAQAAAAAAABACABMAAQAAAAAAABABABEAAQAAAAAAABAAABMAAQABAAAAAAA=")
tile_set = ExtResource("16_cby7n")

[node name="door" parent="_" instance=ExtResource("18_7vvwf")]
position = Vector2(-48, 544)
scene_path = "res://src/levels/dream/sane/light_void/level.tscn"

[node name="nexus" parent="_" instance=ExtResource("18_7vvwf")]
position = Vector2(241, 104)
scene_path = "res://src/levels/dream/sane/nexus/level.tscn"
trigger = SubResource("Resource_bjrq6")

[node name="_" parent="_/nexus" index="1"]
texture = ExtResource("23_orxyj")

[editable path="camera"]
[editable path="_/Sally"]
[editable path="_/Sally/effect_equip_anim"]
[editable path="_/nexus"]
