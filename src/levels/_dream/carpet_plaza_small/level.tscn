[gd_scene load_steps=28 format=4 uid="uid://b6i5pb6sb3k7u"]

[ext_resource type="Script" uid="uid://b1ofr4umso5jf" path="res://src/systems/scenes/game/game_scene.gd" id="1_0p3g1"]
[ext_resource type="PackedScene" uid="uid://c8bnpo28a373g" path="res://src/systems/camera/camera.tscn" id="2_vpy4h"]
[ext_resource type="TileSet" uid="uid://dyssxbp7xitvm" path="res://src/levels/__ignore/tile_set/_footstep_material.tres" id="3_evm5a"]
[ext_resource type="Script" uid="uid://pksfkcvcsgx7" path="res://src/levels/__ignore/tilemap_footstep_setup.gd" id="4_icfgu"]
[ext_resource type="TileSet" uid="uid://b0kyfgy4bib24" path="res://src/levels/__ignore/tile_set/_common_objs.tres" id="5_cucml"]
[ext_resource type="Resource" uid="uid://dckhwskiv5dqb" path="res://src/audio/footsteps/cloth.tres" id="5_fbe1s"]
[ext_resource type="TileSet" uid="uid://bkcgvm5skhdni" path="res://src/levels/__ignore/tile_set/world_tile_sets/carpet_plaza.tres" id="7_366jw"]
[ext_resource type="PackedScene" uid="uid://ryhx8o46er7i" path="res://src/player/2D/madotsuki/madotsuki.tscn" id="8_5ojlw"]
[ext_resource type="PackedScene" uid="uid://d2oedgst7bbj2" path="res://src/entities/sentients/hell/hell_spawn_template.tscn" id="8_iuqtm"]
[ext_resource type="Script" uid="uid://jf85vmwx4pj" path="res://src/player/2D/scripts/pl_variables.gd" id="9_evm5a"]
[ext_resource type="Script" uid="uid://c1od80bn28h0l" path="res://src/systems/sequencing/sequence_interface.gd" id="11_5j508"]
[ext_resource type="Script" uid="uid://bxe7uci7t77tx" path="res://src/entities/sb_variables.gd" id="11_icfgu"]
[ext_resource type="Script" uid="uid://bxh774473av7t" path="res://src/systems/interaction/interactable.gd" id="13_5j508"]
[ext_resource type="Script" uid="uid://f4sb25g3gpic" path="res://src/systems/sequencing/sequence/game/sequence_region.gd" id="14_fbe1s"]
[ext_resource type="Script" uid="uid://ctqw6a8qsvnv4" path="res://src/systems/sequencing/event/audio/play_bgm.gd" id="15_jeu81"]
[ext_resource type="AudioStream" uid="uid://b6mtbauq1ex02" path="res://src/audio/bgm/silas_lumentorch.ogg" id="16_5ojlw"]
[ext_resource type="Script" uid="uid://b6ilkvabn22lp" path="res://src/systems/sequencing/sequence/conditional/if_expression.gd" id="16_td5s7"]
[ext_resource type="Script" uid="uid://c0ymap76lrhgr" path="res://src/systems/sequencing/event/scene/travel_to_scene.gd" id="17_fbe1s"]
[ext_resource type="Script" uid="uid://dxx2gbg56i1ts" path="res://src/systems/sequencing/event/scene/apply_panorama.gd" id="17_jb0mk"]
[ext_resource type="Script" uid="uid://btgm8okupfro7" path="res://src/systems/region/cam_deadzone.gd" id="18_5j508"]
[ext_resource type="Script" uid="uid://ofyfa3d6ql28" path="res://src/systems/components/independent/spawn_point.gd" id="18_eicbg"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_etem8"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_o1cqx"]

[sub_resource type="Resource" id="Resource_5j508"]
resource_local_to_scene = true
resource_name = "sb_variables"
script = ExtResource("11_icfgu")

[sub_resource type="Resource" id="Resource_fbe1s"]
resource_local_to_scene = true
resource_name = "pl_variables"
script = ExtResource("9_evm5a")

[sub_resource type="RectangleShape2D" id="RectangleShape2D_s5cch"]
size = Vector2(48, 16)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_fbe1s"]
size = Vector2(656, 407)

[node name="carpet_plaza" type="Node" node_paths=PackedStringArray("seq_initial", "seq_free")]
script = ExtResource("1_0p3g1")
seq_initial = NodePath("on_initial")
seq_free = NodePath("on_free")
load_transition = SubResource("ShaderMaterial_etem8")
unload_transition = SubResource("ShaderMaterial_o1cqx")
metadata/_custom_type_script = "uid://b1ofr4umso5jf"

[node name="camera" parent="." node_paths=PackedStringArray("initial_target") instance=ExtResource("2_vpy4h")]
position = Vector2(248, 736)
initial_target = NodePath("../y_order/madotsuki")

[node name="y_order" type="Node2D" parent="."]
y_sort_enabled = true

[node name="material_cloth" type="TileMapLayer" parent="y_order"]
tile_map_data = PackedByteArray("AAAIACcAAAAAAAEAAAAJACcAAAACAAIAAAAHACcAAAACAAIAABASAC0AAAACAAIAABATAC0AAAAAAAEAAAAUAC0AAAACAAIAAAAWACkAAAACAAIAABAXACkAAAAAAAEAAAAYACkAAAACAAIAAAAGAC0AAAACAAIAABAHAC0AAAAAAAEAAAAIAC0AAAACAAIAAAAAADIAAAACAAIAABABADIAAAAAAAEAAAACADIAAAACAAIAAAAfACkAAAACAAIAABAgACkAAAAAAAEAAAAhACkAAAACAAIAAAAMACoAAAAAAAEAAAAMACsAAAAAAAIAAAANACsAAAAAAAIAAAAOACsAAAAAAAIAAAAOACoAAAAAAAEAAAAOACkAAAAAAAIAACANACkAAAAAAAIAACAMACkAAAAAAAIAACANACoAAAAAAAEAAAAPACkAAAACAAEAACAPACsAAAACAAEAAAAPACoAAAACAAIAAAALACoAAAACAAIAABALACkAAAACAAEAADALACsAAAACAAEAABAJADAAAAACAAEAADAJADEAAAACAAIAABAJADIAAAACAAEAABAKADAAAAAAAAIAACAKADEAAAAAAAEAAAAKADIAAAAAAAIAAAALADAAAAAAAAIAACALADEAAAAAAAEAAAALADIAAAAAAAIAAAAMADAAAAAAAAIAACAMADEAAAAAAAEAAAAMADIAAAAAAAIAAAANADAAAAACAAEAACANADEAAAACAAIAAAANADIAAAACAAEAAAA=")
tile_set = ExtResource("3_evm5a")
script = ExtResource("4_icfgu")
ground_material = ExtResource("5_fbe1s")
metadata/_custom_type_script = "uid://pksfkcvcsgx7"

[node name="spikes" type="TileMapLayer" parent="y_order"]
y_sort_enabled = true
tile_map_data = PackedByteArray("AAD//zYAAAALAA0AAAAAADYAAAALAA0AAAAAADcAAAAMAAwAAAABADcAAAALAA0AAAALADUAAAALAA0AAAALADYAAAAMAAwAAAALADcAAAAMAAwAAAAMADUAAAALAA0AAAANADQAAAALAA0AAAAOADQAAAALAA0AAAAPADQAAAALAA0AAAAQADQAAAALAA0AAAAQADMAAAALAA0AAAARADMAAAAMAAwAAAASADMAAAAMAAwAAAATADMAAAALAA0AAAAUADMAAAALAA0AAAAVADIAAAALAA0AAAAUADIAAAALAA0AAAAJADYAAAAGAAMAAAAIADoAAAAMAAwAAAAJADoAAAALAA0AAAAGADYAAAAGAAMAAAAGADoAAAALAA0AAAACADcAAAALAA0AAAADADYAAAALAA0AAAADADcAAAALAA0AAAAEADQAAAALAA0AAAAEADUAAAALAA0AAAAEADYAAAALAA0AAAAEADcAAAAMAAwAAAACADYAAAAMAAwAAAACADgAAAALAA0AAAADADQAAAALAA0AAAADADUAAAAMAAwAAAAEADgAAAALAA0AAAAEADkAAAALAA0AAAAEADoAAAAMAAwAAAAFADoAAAALAA0AAAAFADkAAAAMAAwAAAAHADoAAAALAA0AAAALADgAAAALAA0AAAALADkAAAALAA0AAAAKADoAAAALAA0AAAAKADkAAAAMAAwAAAAMADgAAAALAA0AAAAMADcAAAALAA0AAAAMADYAAAAMAAwAAAAGADUAAAAGAAMAAAAGADQAAAAGAAMAAAAJADUAAAAGAAMAAAAJADQAAAAGAAMAAAD//zUAAAALAA0AAAD//zQAAAAMAAwAAAD//zMAAAALAA0AAAD+/zMAAAALAA0AAAD+/zIAAAAMAAwAAAD+/zEAAAALAA0AAAD//zEAAAAMAAwAAAD//zAAAAALAA0AAAAAADAAAAALAA0AAAABADAAAAALAA0AAAACAC8AAAALAA0AAAACAC4AAAALAA0AAAACAC0AAAAMAAwAAAACACwAAAALAA0AAAADACwAAAAMAAwAAAAEACwAAAAMAAwAAAAEACsAAAAMAAwAAAADACsAAAALAA0AAAADACoAAAALAA0AAAACACkAAAALAA0AAAACACgAAAAMAAwAAAADACcAAAALAA0AAAADACYAAAALAA0AAAAEACYAAAAMAAwAAAAFACUAAAALAA0AAAAGACUAAAAMAAwAAAAHACQAAAALAA0AAAAIACQAAAALAA0AAAAJACQAAAALAA0AAAAJACUAAAALAA0AAAAKACUAAAALAA0AAAALACUAAAALAA0AAAAMACUAAAAMAAwAAAAOACYAAAALAA0AAAAPACcAAAALAA0AAAAQACcAAAALAA0AAAARACcAAAALAA0AAAASACcAAAAMAAwAAAASACYAAAAMAAwAAAATACYAAAALAA0AAAAUACYAAAALAA0AAAAVACYAAAALAA0AAAAWACUAAAALAA0AAAAXACUAAAAMAAwAAAAYACYAAAAMAAwAAAAZACYAAAAMAAwAAAAaACYAAAALAA0AAAAaACcAAAAMAAwAAAAMACYAAAAMAAwAAAANACUAAAALAA0AAAACACcAAAALAA0AAAAbACgAAAALAA0AAAAcACgAAAALAA0AAAAdACgAAAALAA0AAAAeACcAAAALAA0AAAAfACcAAAALAA0AAAAgACcAAAALAA0AAAAhACcAAAALAA0AAAAiACcAAAALAA0AAAAiACgAAAALAA0AAAAjACkAAAALAA0AAAAkACoAAAAMAAwAAAAkACsAAAALAA0AAAAkACwAAAALAA0AAAAkAC0AAAALAA0AAAAjAC4AAAAMAAwAAAAiAC4AAAALAA0AAAAhAC4AAAALAA0AAAAgAC8AAAALAA0AAAAfAC8AAAALAA0AAAAfADAAAAAMAAwAAAAeADAAAAALAA0AAAAeAC8AAAALAA0AAAAdAC8AAAAMAAwAAAAcAC8AAAALAA0AAAAcAC4AAAALAA0AAAAbAC4AAAALAA0AAAAaAC4AAAALAA0AAAAZAC4AAAALAA0AAAAZAC8AAAAMAAwAAAAYAC8AAAALAA0AAAAYADAAAAALAA0AAAAXADEAAAALAA0AAAAXADIAAAALAA0AAAAWADIAAAAMAAwAAAA=")
tile_set = ExtResource("5_cucml")

[node name="carpets" type="TileMapLayer" parent="y_order"]
y_sort_enabled = true
tile_map_data = PackedByteArray("AAATAC0AAAADAAAAAAAIACcAAAADAAAAAAAXACkAAAAAAAAAAAANACoAAAAAAAIAAAABADIAAAAAAAAAAAAHAC0AAAAAAAAAAAALADEAAAAGAAIAAAAgACkAAAADAAAAAAA=")
tile_set = ExtResource("7_366jw")

[node name="hellspawn" parent="y_order" instance=ExtResource("8_iuqtm")]
position = Vector2(512, 688)
values = SubResource("Resource_5j508")

[node name="sprite_renderer" parent="y_order/hellspawn" index="1"]
frame = 6
progress = 6

[node name="on_interact" parent="y_order/hellspawn/to_hell" index="1" node_paths=PackedStringArray("order", "back")]
order = [NodePath("request_cutscene_start"), NodePath("hell_enter_trans"), NodePath("travel_to_scene")]
back = NodePath("travel_to_scene")

[node name="hell_enter_trans" parent="y_order/hellspawn/to_hell/on_interact" index="1" node_paths=PackedStringArray("next")]
next = NodePath("../travel_to_scene")

[node name="travel_to_scene" type="Node" parent="y_order/hellspawn/to_hell/on_interact" index="2" node_paths=PackedStringArray("spawn_point", "prev")]
process_mode = 4
script = ExtResource("17_fbe1s")
scene_path = "uid://m50bp6u4vgts"
connection_id = "hell"
spawn_point = NodePath("../../spawn_point")
prev = NodePath("../hell_enter_trans")
metadata/_custom_type_script = "uid://c0ymap76lrhgr"

[node name="spawn_point" type="Node2D" parent="y_order/hellspawn/to_hell" index="2" node_paths=PackedStringArray("parent_instead_of_self")]
position = Vector2(0, 16)
script = ExtResource("18_eicbg")
scene_path = "uid://m50bp6u4vgts"
connection_id = "hell"
parent_instead_of_self = NodePath("../../..")
metadata/_custom_type_script = "uid://ofyfa3d6ql28"

[node name="madotsuki" parent="y_order" instance=ExtResource("8_5ojlw")]
position = Vector2(248, 736)
values = SubResource("Resource_fbe1s")

[node name="to_carpet_plaza" type="Area2D" parent="y_order" node_paths=PackedStringArray("rect")]
position = Vector2(128, 864)
collision_layer = 2684354562
collision_mask = 3758096384
script = ExtResource("13_5j508")
secret = true
rect = NodePath("rect")
metadata/_custom_type_script = "uid://bxh774473av7t"

[node name="rect" type="CollisionShape2D" parent="y_order/to_carpet_plaza"]
shape = SubResource("RectangleShape2D_s5cch")
debug_color = Color(0.2, 0, 0.7, 0.2)

[node name="sequence_region" type="Node" parent="y_order/to_carpet_plaza" node_paths=PackedStringArray("enter_sequence", "exit_sequence")]
process_mode = 4
script = ExtResource("14_fbe1s")
enter_sequence = NodePath("enter")
exit_sequence = NodePath("exit")
metadata/_custom_type_script = "uid://f4sb25g3gpic"

[node name="enter" type="Node" parent="y_order/to_carpet_plaza/sequence_region" node_paths=PackedStringArray("order", "front", "back")]
script = ExtResource("11_5j508")
order = [NodePath("if_pl_moving_south"), NodePath("else_if_pl_moving_south")]
front = NodePath("if_pl_moving_south")
back = NodePath("else_if_pl_moving_south")

[node name="if_pl_moving_south" type="Node" parent="y_order/to_carpet_plaza/sequence_region/enter" node_paths=PackedStringArray("input_objects", "else_conditional", "order", "front", "back", "next")]
script = ExtResource("16_td5s7")
expression = "pl.velocity.y > 0"
input_objects = {
"pl": NodePath("../../../../madotsuki")
}
else_conditional = NodePath("../else_if_pl_moving_south")
order = [NodePath("travel_to")]
front = NodePath("travel_to")
back = NodePath("travel_to")
custom_linked_pointers = true
next = NodePath("../else_if_pl_moving_south")
metadata/_custom_type_script = "uid://br7tiv3hm32fy"

[node name="travel_to" type="Node" parent="y_order/to_carpet_plaza/sequence_region/enter/if_pl_moving_south" node_paths=PackedStringArray("spawn_point")]
process_mode = 4
script = ExtResource("17_fbe1s")
scene_path = "uid://j0sat4n1ufx1"
spawn_point = NodePath("spawn")
metadata/_custom_type_script = "uid://0v2nidb8jsha"

[node name="spawn" type="Node2D" parent="y_order/to_carpet_plaza/sequence_region/enter/if_pl_moving_south/travel_to" node_paths=PackedStringArray("parent_instead_of_self")]
position = Vector2(128, 856)
script = ExtResource("18_eicbg")
scene_path = "uid://j0sat4n1ufx1"
parent_instead_of_self = NodePath("../../../../../..")
as_sibling = false
heading = 0
metadata/_custom_type_script = "uid://ofyfa3d6ql28"

[node name="else_if_pl_moving_south" type="Node" parent="y_order/to_carpet_plaza/sequence_region/enter" node_paths=PackedStringArray("prev")]
script = ExtResource("11_5j508")
skip = true
prev = NodePath("../if_pl_moving_south")

[node name="exit" type="Node" parent="y_order/to_carpet_plaza/sequence_region"]
script = ExtResource("11_5j508")

[node name="deadzone" type="Area2D" parent="y_order" node_paths=PackedStringArray("rect")]
process_mode = 3
position = Vector2(200, 688)
collision_layer = 0
collision_mask = 1073741824
script = ExtResource("18_5j508")
rect = NodePath("rect")
metadata/_custom_type_script = "uid://btgm8okupfro7"

[node name="rect" type="CollisionShape2D" parent="y_order/deadzone"]
position = Vector2(88, 68.5)
shape = SubResource("RectangleShape2D_fbe1s")
debug_color = Color(0.2, 0, 0.7, 0.2)

[node name="on_initial" type="Node" parent="." node_paths=PackedStringArray("order", "front", "back")]
script = ExtResource("11_5j508")
order = [NodePath("bgm"), NodePath("panorama")]
skip_invalid_events = true
front = NodePath("bgm")
back = NodePath("panorama")

[node name="bgm" type="Node" parent="on_initial" node_paths=PackedStringArray("next")]
process_mode = 4
script = ExtResource("15_jeu81")
stream = ExtResource("16_5ojlw")
vol = 0.5
pitch = 0.2
next = NodePath("../panorama")
metadata/_custom_type_script = "uid://ctqw6a8qsvnv4"

[node name="panorama" type="Node" parent="on_initial" node_paths=PackedStringArray("subviewport", "pivot", "prev")]
script = ExtResource("17_jb0mk")
subviewport = NodePath("subviewport")
pivot = NodePath("pivot")
prev = NodePath("../bgm")
metadata/_custom_type_script = "uid://dxx2gbg56i1ts"

[node name="pivot" type="Marker2D" parent="on_initial/panorama"]

[node name="subviewport" type="SubViewport" parent="on_initial/panorama"]
own_world_3d = true
transparent_bg = true
canvas_item_default_texture_filter = 0
canvas_item_default_texture_repeat = 2
size = Vector2i(480, 270)
size_2d_override = Vector2i(480, 270)

[node name="ColorRect" type="ColorRect" parent="on_initial/panorama/subviewport"]
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
color = Color(0, 0, 0, 1)

[node name="on_free" type="Node" parent="."]
script = ExtResource("11_5j508")
skip_invalid_events = true

[editable path="camera"]
[editable path="y_order/hellspawn"]
