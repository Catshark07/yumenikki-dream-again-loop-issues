[gd_scene load_steps=20 format=4 uid="uid://pv68n6xubxic"]

[ext_resource type="Script" uid="uid://b1ofr4umso5jf" path="res://src/systems/scenes/game/game_scene.gd" id="1_ah5rn"]
[ext_resource type="Script" uid="uid://c1od80bn28h0l" path="res://src/systems/sequencing/sequence_interface.gd" id="3_dj02f"]
[ext_resource type="Script" uid="uid://ctqw6a8qsvnv4" path="res://src/systems/sequencing/event/audio/play_bgm.gd" id="4_ut3ag"]
[ext_resource type="AudioStream" uid="uid://b4ccjxsuwusfl" path="res://src/audio/bgm/2kki_zaza.wav" id="5_6i208"]
[ext_resource type="Script" uid="uid://dxx2gbg56i1ts" path="res://src/systems/sequencing/event/scene/apply_panorama.gd" id="7_wa1an"]
[ext_resource type="Shader" uid="uid://crclnnrqddewa" path="res://src/shaders/panorama/depth.gdshader" id="8_aoe6l"]
[ext_resource type="PackedScene" uid="uid://c8bnpo28a373g" path="res://src/systems/camera/camera.tscn" id="8_d6ort"]
[ext_resource type="Texture2D" uid="uid://bkiyc7axrhgdt" path="res://src/images/panorama/deep.png" id="8_qwdne"]
[ext_resource type="PackedScene" uid="uid://ryhx8o46er7i" path="res://src/player/2D/madotsuki/madotsuki.tscn" id="9_u75xj"]
[ext_resource type="Script" uid="uid://jf85vmwx4pj" path="res://src/player/2D/scripts/pl_variables.gd" id="10_p7cap"]
[ext_resource type="Script" uid="uid://bxh774473av7t" path="res://src/systems/interaction/interactable.gd" id="10_wa1an"]
[ext_resource type="TileSet" uid="uid://bior84yl5ty0u" path="res://src/levels/__ignore/tile_set/world_tile_sets/apartment_real.tres" id="11_e6mh2"]
[ext_resource type="Script" uid="uid://bkadpjx8csm75" path="res://src/systems/sequencing/sequence/game/on_interact.gd" id="11_qwdne"]
[ext_resource type="Script" uid="uid://qo665eecfxcw" path="res://src/systems/sequencing/event/player/teleport_sentient.gd" id="14_d6ort"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_ttrd8"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_q0ft1"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_e6mh2"]
shader = ExtResource("8_aoe6l")
shader_parameter/initial_uv_offset = Vector2(0, 0)
shader_parameter/offset_strength = 0.575
shader_parameter/offset_strength_influence = Vector2(1, 1)
shader_parameter/overlay_modulate = Color(0, 0, 0, 1)
shader_parameter/transparency = 0.0
shader_parameter/optional_gradient = false

[sub_resource type="Resource" id="Resource_d6ort"]
resource_local_to_scene = true
resource_name = "pl_variables"
script = ExtResource("10_p7cap")
metadata/_custom_type_script = "uid://jf85vmwx4pj"

[sub_resource type="RectangleShape2D" id="RectangleShape2D_qwdne"]
size = Vector2(64, 0)

[node name="asas" type="Node" node_paths=PackedStringArray("seq_initial")]
script = ExtResource("1_ah5rn")
seq_initial = NodePath("on_initial")
load_transition = SubResource("ShaderMaterial_ttrd8")
unload_transition = SubResource("ShaderMaterial_q0ft1")
metadata/_custom_type_script = "uid://b1ofr4umso5jf"

[node name="on_initial" type="Node" parent="." node_paths=PackedStringArray("order", "front", "back")]
script = ExtResource("3_dj02f")
order = [NodePath("play_bgm"), NodePath("panorama")]
front = NodePath("play_bgm")
back = NodePath("panorama")

[node name="play_bgm" type="Node" parent="on_initial" node_paths=PackedStringArray("next")]
process_mode = 4
script = ExtResource("4_ut3ag")
stream = ExtResource("5_6i208")
next = NodePath("../panorama")
metadata/_custom_type_script = "uid://ctqw6a8qsvnv4"

[node name="panorama" type="Node" parent="on_initial" node_paths=PackedStringArray("subviewport", "pivot", "prev")]
process_mode = 4
script = ExtResource("7_wa1an")
subviewport = NodePath("subviewport")
pivot = NodePath("pivot")
prev = NodePath("../play_bgm")
metadata/_custom_type_script = "uid://0v2nidb8jsha"

[node name="pivot" type="Marker2D" parent="on_initial/panorama"]

[node name="subviewport" type="SubViewport" parent="on_initial/panorama"]
own_world_3d = true
transparent_bg = true
canvas_item_default_texture_filter = 0
canvas_item_default_texture_repeat = 2
size = Vector2i(480, 270)
size_2d_override = Vector2i(480, 270)

[node name="TextureRect" type="TextureRect" parent="on_initial/panorama/subviewport"]
material = SubResource("ShaderMaterial_e6mh2")
offset_right = 40.0
offset_bottom = 40.0
texture = ExtResource("8_qwdne")

[node name="Node2D" type="Node2D" parent="."]

[node name="camera_handler" parent="." node_paths=PackedStringArray("initial_target") instance=ExtResource("8_d6ort")]
position = Vector2(-16, 36)
initial_target = NodePath("../madotsuki")

[node name="madotsuki" parent="." instance=ExtResource("9_u75xj")]
position = Vector2(-16, 36)
values = SubResource("Resource_d6ort")

[node name="TileMapLayer" type="TileMapLayer" parent="."]
tile_map_data = PackedByteArray("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AAD9/wMAAQACAAUAAAAAAAUAAQACAAUAAAD5//7/AQAEAAIAAAD5////AQAEAAMAAAD5/wAAAQAEAAIAAAD5/wEAAQAEAAMAAAD5/wIAAQAEAAIAAAD5/wMAAQAEAAMAAAD7//7/AQAEAAIAAAD7////AQAEAAMAAAD7/wAAAQAEAAIAAAD7/wEAAQAEAAMAAAD7/wIAAQAEAAIAAAD7/wMAAQAEAAMAAAA7AA4AAQAEAAIAAAA7AA8AAQAEAAMAAAA7ABAAAQAEAAIAAAA7ABEAAQAEAAMAAAA7ABIAAQAEAAIAAAA7ABMAAQAEAAMAAAA9AA4AAQAEAAIAAAA9AA8AAQAEAAMAAAA9ABAAAQAEAAIAAAA9ABEAAQAEAAMAAAA9ABIAAQAEAAIAAAA9ABMAAQAEAAMAAAA/ABMAAQACAAUAAAANAAQAAQACAAQAAAAGAP7/AQAEAAIAAAAGAP//AQAEAAMAAAAGAAAAAQAEAAIAAAAGAAEAAQAEAAMAAAAGAAIAAQAEAAIAAAAGAAMAAQAEAAMAAAAIAP7/AQAEAAIAAAAIAP//AQAEAAMAAAAIAAAAAQAEAAIAAAAIAAEAAQAEAAMAAAAIAAIAAQAEAAIAAAAIAAMAAQAEAAMAAAA=")
tile_set = ExtResource("11_e6mh2")

[node name="Interactable" type="Area2D" parent="." node_paths=PackedStringArray("rect")]
position = Vector2(-88, 16)
collision_layer = 0
collision_mask = 2147483648
script = ExtResource("10_wa1an")
secret = true
area = true
centre_trigger = true
rect = NodePath("rect")
metadata/_custom_type_script = "uid://bxh774473av7t"

[node name="rect" type="CollisionShape2D" parent="Interactable"]
shape = SubResource("RectangleShape2D_qwdne")
debug_color = Color(0.2, 0, 0.7, 0.2)

[node name="OnInteract" type="Node" parent="Interactable" node_paths=PackedStringArray("order", "front", "back")]
process_mode = 4
script = ExtResource("11_qwdne")
order = [NodePath("displace_player")]
front = NodePath("displace_player")
back = NodePath("displace_player")
metadata/_custom_type_script = "uid://bkadpjx8csm75"

[node name="displace_player" type="Node" parent="Interactable/OnInteract" node_paths=PackedStringArray("sentient", "marker")]
process_mode = 3
script = ExtResource("14_d6ort")
displace = true
sentient = NodePath("../../../madotsuki")
dis_vector = Vector2i(208, 0)
marker = NodePath("marker")

[node name="marker" type="Marker2D" parent="Interactable/OnInteract/displace_player"]
position = Vector2(-88, 16)
gizmo_extents = 0.0
