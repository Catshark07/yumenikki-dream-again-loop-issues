[gd_scene load_steps=29 format=4 uid="uid://b5h2bldsnmdsb"]

[ext_resource type="Script" uid="uid://b1ofr4umso5jf" path="res://src/systems/scenes/game/game_scene.gd" id="1_vndl4"]
[ext_resource type="AudioStream" uid="uid://df1213omvvset" path="res://src/audio/bgm/luff_yta_eye.ogg" id="3_qi1ih"]
[ext_resource type="Script" uid="uid://bptlrkdn0tpua" path="res://src/systems/components/overrides/wiggle.gd" id="5_bsomg"]
[ext_resource type="PackedScene" uid="uid://c8bnpo28a373g" path="res://src/systems/camera/camera.tscn" id="5_jx2yo"]
[ext_resource type="Shader" uid="uid://b4qcyrwpo36fo" path="res://src/shaders/panorama/distortion_texture.gdshader" id="5_nqkx8"]
[ext_resource type="PackedScene" uid="uid://ryhx8o46er7i" path="res://src/player/2D/madotsuki/madotsuki.tscn" id="5_u851k"]
[ext_resource type="Texture2D" uid="uid://cm6iimafcot25" path="res://src/images/panorama/face.png" id="6_hdfwf"]
[ext_resource type="Script" uid="uid://bxh774473av7t" path="res://src/systems/interaction/base_interactable.gd" id="7_gg2wt"]
[ext_resource type="Script" uid="uid://bkadpjx8csm75" path="res://src/systems/sequencing/sequence/game/on_interact.gd" id="8_qh5wl"]
[ext_resource type="Script" uid="uid://b8vm7vkk5240d" path="res://src/systems/sequencing/event/player/append_effect.gd" id="9_3vpbd"]
[ext_resource type="TileSet" uid="uid://b7vdcqrtnh77e" path="res://src/levels/_dream/colourful_irises/obstacles/bloody_tileset.tres" id="9_n1xg1"]
[ext_resource type="Script" uid="uid://ctqw6a8qsvnv4" path="res://src/systems/sequencing/event/audio/play_music.gd" id="9_q6f27"]
[ext_resource type="Resource" uid="uid://w1ycqdwy7pk8" path="res://src/player/2D/madotsuki/effects/bike/bike.tres" id="10_8vxfw"]
[ext_resource type="Texture2D" uid="uid://do5gh2pld28x8" path="res://src/levels/_dream/apartment_balcony/sprites/bubble.png" id="11_4yua0"]
[ext_resource type="Script" uid="uid://ofyfa3d6ql28" path="res://src/systems/components/independent/spawn_point.gd" id="12_4yua0"]
[ext_resource type="Script" uid="uid://f4sb25g3gpic" path="res://src/systems/sequencing/sequence/game/sequence_region.gd" id="13_bwsrp"]
[ext_resource type="Script" uid="uid://dxx2gbg56i1ts" path="res://src/systems/sequencing/event/scene/apply_panorama.gd" id="13_xm48m"]
[ext_resource type="Script" uid="uid://c0ymap76lrhgr" path="res://src/systems/sequencing/event/scene/travel_to_scene.gd" id="15_s5ewf"]
[ext_resource type="Script" uid="uid://dkbhr01xbyr60" path="res://src/systems/components/independent/scene_traversal.gd" id="16_v680p"]
[ext_resource type="TileSet" uid="uid://dlytw3uf7vjuh" path="res://src/levels/_dream/colourful_irises/obstacles/eye_tileset.tres" id="18_nqkx8"]
[ext_resource type="Script" uid="uid://c1od80bn28h0l" path="res://src/systems/sequencing/sequence_interface.gd" id="20_5siph"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_bsomg"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_rlt31"]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_bwsrp"]
size = Vector2(16, 16)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_gg2wt"]
size = Vector2(48, 16)

[sub_resource type="FastNoiseLite" id="FastNoiseLite_e2px4"]

[sub_resource type="NoiseTexture2D" id="NoiseTexture2D_yqgqu"]
noise = SubResource("FastNoiseLite_e2px4")

[sub_resource type="ShaderMaterial" id="ShaderMaterial_ndxk6"]
shader = ExtResource("5_nqkx8")
shader_parameter/overlay_modulate = Color(0, 0, 0, 1)
shader_parameter/transparency = 0.0
shader_parameter/dirX = 1.49012e-08
shader_parameter/dirY = 1.0
shader_parameter/scroll_speed = 0.055
shader_parameter/initial_uv_offset = Vector2(0, 0)
shader_parameter/snapped_val = 0.0016
shader_parameter/offset_strength = 0.3
shader_parameter/offset_strength_influence = Vector2(1, 1)
shader_parameter/texture_scroll = false
shader_parameter/noise_strength = 1.0
shader_parameter/noise_fwd = SubResource("NoiseTexture2D_yqgqu")

[node name="colorful_irises" type="Node" node_paths=PackedStringArray("seq_initial", "seq_free", "scene_objects")]
script = ExtResource("1_vndl4")
seq_initial = NodePath("on_initial")
seq_free = NodePath("on_free")
scene_objects = [NodePath("on_initial"), NodePath("on_free")]
load_transition = SubResource("ShaderMaterial_bsomg")
unload_transition = SubResource("ShaderMaterial_rlt31")

[node name="camera" parent="." node_paths=PackedStringArray("initial_target") instance=ExtResource("5_jx2yo")]
position = Vector2(80, -8)
initial_target = NodePath("../world/mado")

[node name="STATIC" parent="camera/cam_fsm" index="0" node_paths=PackedStringArray("transitions")]
transitions = []

[node name="FOLLOWING" parent="camera/cam_fsm" index="1" node_paths=PackedStringArray("transitions")]
transitions = []

[node name="CHANGING_TARGET" parent="camera/cam_fsm" index="2" node_paths=PackedStringArray("transitions")]
transitions = []

[node name="Wiggle" type="Node" parent="camera/marker/camera/components_receiver" index="0"]
script = ExtResource("5_bsomg")
metadata/_custom_type_script = "uid://bptlrkdn0tpua"

[node name="world" type="Node2D" parent="."]
y_sort_enabled = true
position = Vector2(72, -48)

[node name="mado" parent="world" instance=ExtResource("5_u851k")]
position = Vector2(8, 40)

[node name="blood_tile" type="TileMapLayer" parent="world"]
z_index = -1
use_parent_material = true
tile_map_data = PackedByteArray("AAD+/wAAAAABAAEAABD+/wEAAAABAAEAABD//wEAAAAAAAEAAAD//wIAAAAAAAEAAAD//wAAAAAAAAEAAAD/////AAABAAEAAGD+////AAABAAMAABD//wMAAAABAAMAABD//wQAAAABAAMAADD+/wIAAAABAAAAADATAAQAAAAAAAQAAFAUAAQAAAAAAAMAAHAVAAQAAAAAAAEAAAAWAAMAAAABAAMAABAWAAQAAAAAAAEAAAAXAAMAAAAAAAEAAAAXAAQAAAABAAMAACAAAAsAAAAAAAQAADAAAAwAAAAAAAMAADAAAA0AAAAAAAIAADAAAA4AAAAAAAEAADAAAA8AAAAAAAMAAAAAABAAAAAAAAQAAAAAABEAAAAAAAQAACAAABIAAAAAAAMAACAAABMAAAAAAAIAACAAABQAAAAAAAEAACAAABUAAAAAAAEAACAAABYAAAAAAAEAAAAAABcAAAAAAAEAAAAAABgAAAAAAAIAAAAAABoAAAAAAAQAAADn/x8AAAABAAAAABDo/x4AAAABAAAAABDp/x0AAAAAAAIAADDp/yAAAAABAAAAACDq/x0AAAABAAEAAADq/x8AAAABAAAAACDq/yUAAAAAAAEAAADr/yYAAAABAAMAACAAABkAAAAAAAMAAAAVAPD/AAAAAAEAAFAVAPH/AAAAAAEAAAAWAPD/AAAAAAEAAAAWAPH/AAAAAAEAAAAXAO//AAABAAEAAGAXAPD/AAAAAAEAAAAXAPH/AAAAAAEAAAAYAO7/AAABAAEAAGAYAO//AAAAAAEAAAAYAPD/AAAAAAEAAAAYAPH/AAAAAAEAAAAZAO7/AAABAAEAAGAZAO//AAAAAAEAAAAZAPD/AAAAAAEAAAAaAO7/AAABAAEAAGAaAO//AAAAAAEAAAAaAPD/AAAAAAEAAAAbAO7/AAABAAEAAGAbAO//AAAAAAEAAAAbAPD/AAAAAAEAAAAcAO//AAAAAAEAAAAdAO//AAAAAAEAAAAeAO//AAAAAAIAAGATAPH/AAAAAAIAAFAUAPH/AAAAAAEAAFAXAPL/AAAAAAEAAAAXAPP/AAAAAAEAAAAXAPT/AAABAAEAAEAYAPL/AAAAAAEAAAAZAPH/AAAAAAEAAAAZAPL/AAABAAAAACAaAPH/AAAAAAEAAAAbAPH/AAABAAMAACAcAPD/AAAAAAEAAAAdAPD/AAABAAMAACASAPH/AAAAAAMAAFARAPH/AAAAAAQAAFAUAPD/AAABAAMAABAWAO//AAABAAMAABAYAAMAAAABAAMAACAYAAIAAAAAAAEAAAAYAAEAAAAAAAEAAAAXAAIAAAABAAMAABAYAAAAAAAAAAIAACAYAP//AAAAAAMAACAYAP7/AAAAAAQAACAZAAAAAAABAAAAAAAgAO//AAAAAAQAAGAfAO//AAAAAAMAAGAcAO7/AAABAAAAAAAWAPL/AAAAAAEAAAAWAPP/AAABAAEAABAWAPT/AAABAAEAABAWAPX/AAABAAEAABAYAPP/AAABAAMAACAVAPL/AAABAAMAADDn/yAAAAABAAEAABDn/yEAAAABAAMAADDo/x8AAAAAAAEAAADo/yAAAAAAAAEAAADo/yEAAAAAAAEAAADp/x4AAAAAAAEAAADp/x8AAAAAAAEAAADp/yEAAAABAAEAAGDq/x4AAAABAAEAAADq/yEAAAABAAAAAADq/yIAAAAAAAEAAADq/yMAAAAAAAEAAADq/yQAAAAAAAEAAADr/yIAAAABAAMAAADr/yMAAAABAAEAAADr/yQAAAABAAEAAADr/yUAAAABAAEAAADq/yYAAAAAAAIAAAAZAAIAAAABAAEAAAAZAAEAAAABAAEAAAAjACQAAAAAAAQAAHAkACQAAAAAAAMAAHAlACQAAAAAAAIAAHAmACMAAAABAAMAABAmACQAAAAAAAEAAAAnACIAAAABAAAAABAnACMAAAABAAEAAAAnACQAAAABAAEAAAAnACUAAAABAAMAADAoACEAAAABAAAAAGAoACIAAAABAAMAACAoACUAAAABAAMAAAAoACYAAAABAAAAAEApACEAAAAAAAEAAAApACYAAAAAAAEAAAAqACEAAAAAAAEAAAAqACMAAAABAAMAABAqACQAAAABAAMAADAqACYAAAAAAAEAAAArACEAAAAAAAEAABArACMAAAABAAMAAAArACQAAAABAAMAACArACYAAAAAAAEAAAAsACEAAAAAAAEAABAsACYAAAAAAAEAAAAtACEAAAABAAAAAHAtACIAAAABAAMAADAtACUAAAABAAMAABAtACYAAAABAAAAAFAuACIAAAABAAAAAAAuACMAAAABAAEAABAuACQAAAABAAEAABAuACUAAAABAAAAACAvACMAAAABAAMAAAAvACQAAAAAAAEAABAwACQAAAAAAAIAAGAxACQAAAAAAAMAAGAyACQAAAAAAAQAAGA0ACQAAAAAAAQAAHA1ACQAAAAAAAMAAHA2ACQAAAAAAAIAAHA3ACMAAAABAAMAABA3ACQAAAAAAAEAAAA4ACIAAAABAAAAABA4ACMAAAABAAEAAAA4ACQAAAABAAEAAAA4ACUAAAABAAMAADA5ACEAAAABAAAAAGA5ACIAAAABAAMAACA5ACUAAAABAAMAAAA5ACYAAAABAAAAAEA6ACEAAAAAAAEAAAA6ACYAAAAAAAEAAAA7ACEAAAAAAAEAAAA7ACMAAAABAAMAABA7ACQAAAABAAMAADA7ACYAAAAAAAEAAAA8ACEAAAAAAAEAABA8ACMAAAABAAMAAAA8ACQAAAABAAMAACA8ACYAAAAAAAEAAAA9ACEAAAAAAAEAABA9ACYAAAAAAAEAAAA+ACEAAAABAAAAAHA+ACIAAAABAAMAADA+ACUAAAABAAMAABA+ACYAAAABAAAAAFA/ACIAAAABAAAAAAA/ACMAAAABAAEAABA/ACQAAAABAAEAABA/ACUAAAABAAAAACBAACMAAAABAAMAAABAACQAAAAAAAEAABBBACQAAAAAAAIAAGBCACQAAAAAAAMAAGBDACQAAAAAAAQAAGDg/yQAAAAAAAQAAGDq/ycAAAAAAAMAAADq/ygAAAAAAAQAAADp/yIAAAABAAMAADDp/xwAAAAAAAMAADDp/xsAAAAAAAQAADDq/xwAAAABAAIAACDq/xsAAAABAAQAACBKAB8AAAABAAAAABBKACAAAAABAAEAABBKACEAAAABAAMAADBLAB4AAAABAAAAABBLAB8AAAAAAAEAAABLACAAAAAAAAEAAABLACEAAAAAAAEAAABMABsAAAAAAAQAADBMABwAAAAAAAMAADBMAB0AAAAAAAIAADBMAB4AAAAAAAEAAABMAB8AAAAAAAEAAABMACAAAAABAAAAACBMACEAAAABAAEAAGBMACIAAAABAAMAADBNABsAAAABAAQAACBNABwAAAABAAIAACBNAB0AAAABAAEAAABNAB4AAAABAAEAAABNAB8AAAABAAAAACBNACEAAAABAAAAAABNACIAAAAAAAEAAABNACMAAAAAAAEAAABNACQAAAAAAAEAAABNACUAAAAAAAEAAABNACYAAAAAAAIAAABNACcAAAAAAAMAAABNACgAAAAAAAQAAABOACIAAAABAAMAAABOACMAAAABAAEAAABOACQAAAABAAEAAABOACUAAAABAAEAAABOACYAAAABAAMAACARADQAAAAAAAQAAFASADQAAAAAAAMAAFATADQAAAAAAAIAAFAUADMAAAABAAMAABAUADQAAAAAAAEAAFAVADMAAAAAAAEAAFAVADQAAAAAAAEAAAAVADUAAAABAAMAADAWADIAAAABAAMAABAWADMAAAAAAAEAAAAWADQAAAAAAAEAAAAWADUAAAAAAAEAAAAWADYAAAABAAEAABAWADcAAAABAAEAABAWADgAAAABAAEAABAXADIAAAABAAEAAGAXADMAAAAAAAEAAAAXADQAAAAAAAEAAAAXADUAAAAAAAEAAAAXADYAAAAAAAEAAAAXADcAAAABAAEAAEAYADEAAAABAAEAAGAYADIAAAAAAAEAAAAYADMAAAAAAAEAAAAYADQAAAAAAAEAAAAYADUAAAAAAAEAAAAYADYAAAABAAMAACAZADEAAAABAAEAAGAZADIAAAAAAAEAAAAZADMAAAAAAAEAAAAZADQAAAAAAAEAAAAZADUAAAABAAAAACAaADEAAAABAAEAAGAaADIAAAAAAAEAAAAaADMAAAAAAAEAAAAaADQAAAAAAAEAAAAbADEAAAABAAEAAGAbADIAAAAAAAEAAAAbADMAAAAAAAEAAAAbADQAAAABAAMAACAcADEAAAABAAAAAAAcADIAAAAAAAEAAAAcADMAAAAAAAEAAAAdADIAAAAAAAEAAAAdADMAAAABAAMAACAeADIAAAAAAAIAAGAfADIAAAAAAAMAAGAgADIAAAAAAAQAAGABAAEAAAAAAAEAAAABAAIAAAAAAAEAAAABAAMAAAABAAMAACACAAEAAAABAAEAAAACAAIAAAABAAMAACAAAAAAAAAAAAEAAAAAAAEAAAAAAAEAAAAAAAIAAAAAAAEAAAAAAP//AAABAAEAAGAAAAMAAAAAAAEAAAAAAAQAAAAAAAEAAAAAAAYAAAAAAAMAAAAAAAcAAAAAAAQAAAAAAAUAAAAAAAIAAAABAP//AAABAAEAAGABAAAAAAAAAAEAAAACAP//AAABAAMAAAACAAAAAAABAAEAAAA=")
tile_set = ExtResource("9_n1xg1")

[node name="eye_tiles" type="TileMapLayer" parent="world"]
y_sort_enabled = true
tile_map_data = PackedByteArray("AAADAP//AQAAAAAAAAAEAAAAAwAAAAAAAAD7/wMAAwAAAAAAABD8/wQAAgAAAAAAAAD4//z/AQAAAAAAABD6//3/AwAAAAAAAAAYAAYAAwAAAAAAAAAaAAUAAQAAAAAAABDy/xcAAgAAAAAAAAD0/xkAAQAAAAAAAAAkABcAAgAAAAAAABAnABMAAgAAAAAAAAAoABcAAwAAAAAAAAAnABYAAwAAAAAAABAoABoAAQAAAAAAAAAZAO7/AQAAAAAAAAAbAO//AgAAAAAAAAAXAO//AwAAAAAAABAVAPH/AgAAAAAAAAAXAPT/AgAAAAAAABAaAPT/AQAAAAAAAAAPAO7/AQAAAAAAABAQAPD/AwAAAAAAAAD7/+//AwAAAAAAABAAAPD/AwAAAAAAAAACAPH/AwAAAAAAAADy//P/AwAAAAAAABAAAO3/AQAAAAAAAAAHABkAAQAAAAAAAAAJABsAAgAAAAAAAAALABgAAwAAAAAAAAAMABkAAwAAAAAAAADv/yYAAgAAAAAAAADx/ycAAQAAAAAAAAD1/yMAAwAAAAAAABD3/yUAAQAAAAAAABANACUAAwAAAAAAAAAWACYAAwAAAAAAAAAvACMAAQAAAAAAAAAuACEAAQAAAAAAAAAmACMAAQAAAAAAABAnACEAAQAAAAAAABAnACUAAgAAAAAAABAuACUAAgAAAAAAAAApACAAAwAAAAAAABAsACAAAwAAAAAAAAA0AAIAAQAAAAAAAAAyAAUAAgAAAAAAABAyAP7/AwAAAAAAABAzAP//AwAAAAAAABApAPX/AwAAAAAAAAA0ABAAAQAAAAAAAADl/wUAAgAAAAAAAADk/wcAAQAAAAAAABDj////AwAAAAAAAADi/wAAAwAAAAAAAADg/w8AAwAAAAAAAADj/xEAAwAAAAAAAADi/xIAAwAAAAAAABDe/xIAAgAAAAAAABDj/wwAAQAAAAAAAADd//n/AQAAAAAAABDg/yYAAQAAAAAAABDi/x4AAQAAAAAAABDk/yIAAgAAAAAAAAAAAAAAAAAAAAAAAAA=")
tile_set = ExtResource("18_nqkx8")

[node name="Interactable" type="Area2D" parent="world" node_paths=PackedStringArray("rect")]
position = Vector2(96, 40)
collision_layer = 1073741824
collision_mask = 1073741824
script = ExtResource("7_gg2wt")
rect = NodePath("rect")
metadata/_custom_type_script = "uid://bxh774473av7t"

[node name="rect" type="CollisionShape2D" parent="world/Interactable"]
shape = SubResource("RectangleShape2D_bwsrp")
debug_color = Color(0.2, 0, 0.7, 0.2)

[node name="OnInteract" type="Node" parent="world/Interactable"]
script = ExtResource("8_qh5wl")
metadata/_custom_type_script = "uid://bkadpjx8csm75"

[node name="Event" type="Node" parent="world/Interactable/OnInteract"]
script = ExtResource("9_3vpbd")
effect = ExtResource("10_8vxfw")
metadata/_custom_type_script = "uid://0v2nidb8jsha"

[node name="Sprite2D" type="Sprite2D" parent="world/Interactable"]
texture = ExtResource("11_4yua0")

[node name="to_eyeball_world" type="Area2D" parent="world" node_paths=PackedStringArray("rect")]
position = Vector2(8, 8)
collision_layer = 1073741824
collision_mask = 1073741824
script = ExtResource("7_gg2wt")
rect = NodePath("rect")
metadata/_custom_type_script = "uid://bxh774473av7t"

[node name="rect" type="CollisionShape2D" parent="world/to_eyeball_world"]
shape = SubResource("RectangleShape2D_gg2wt")
debug_color = Color(0.2, 0, 0.7, 0.2)

[node name="spawn_point" type="Node2D" parent="world/to_eyeball_world" node_paths=PackedStringArray("parent_instead_of_self")]
script = ExtResource("12_4yua0")
scene_path = "uid://b67q2b5hm6tsu"
parent_instead_of_self = NodePath(".")
metadata/_custom_type_script = "uid://ofyfa3d6ql28"

[node name="sequence_region" type="Node" parent="world/to_eyeball_world" node_paths=PackedStringArray("enter_sequence", "exit_sequence")]
process_mode = 4
script = ExtResource("13_bwsrp")
enter_sequence = NodePath("enter")
exit_sequence = NodePath("exit")
metadata/_custom_type_script = "uid://f4sb25g3gpic"

[node name="enter" type="Node" parent="world/to_eyeball_world/sequence_region"]
script = ExtResource("20_5siph")

[node name="travel_to" type="Node" parent="world/to_eyeball_world/sequence_region/enter" node_paths=PackedStringArray("scene_traversal")]
script = ExtResource("15_s5ewf")
scene_traversal = NodePath("traversal")
metadata/_custom_type_script = "uid://0v2nidb8jsha"

[node name="traversal" type="Node" parent="world/to_eyeball_world/sequence_region/enter/travel_to" node_paths=PackedStringArray("spawn_point")]
script = ExtResource("16_v680p")
scene_path = "uid://b67q2b5hm6tsu"
spawn_point = NodePath("../../../../spawn_point")
metadata/_custom_type_script = "uid://dkbhr01xbyr60"

[node name="exit" type="Node" parent="world/to_eyeball_world/sequence_region"]
script = ExtResource("20_5siph")

[node name="on_initial" type="Node" parent="."]
script = ExtResource("20_5siph")

[node name="BGM" type="Node" parent="on_initial"]
script = ExtResource("9_q6f27")
stream = ExtResource("3_qi1ih")

[node name="apply_panorama" type="TextureRect" parent="on_initial"]
z_index = -25
material = SubResource("ShaderMaterial_ndxk6")
custom_minimum_size = Vector2(480, 270)
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
texture = ExtResource("6_hdfwf")
expand_mode = 3
stretch_mode = 6
script = ExtResource("13_xm48m")

[node name="on_free" type="Node" parent="."]
script = ExtResource("20_5siph")

[editable path="camera"]
