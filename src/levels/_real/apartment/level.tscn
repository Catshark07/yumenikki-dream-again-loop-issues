[gd_scene load_steps=36 format=3 uid="uid://dwst4o7pf4ye7"]

[ext_resource type="Script" uid="uid://b1ofr4umso5jf" path="res://src/systems/scenes/game/game_scene.gd" id="1_gl3nc"]
[ext_resource type="Script" uid="uid://btgm8okupfro7" path="res://src/systems/region/cam_deadzone.gd" id="4_jd4xj"]
[ext_resource type="Texture2D" uid="uid://dbyvt12xvets3" path="res://src/levels/_real/apartment/background.png" id="4_kxofn"]
[ext_resource type="Texture2D" uid="uid://cr3septns1m3e" path="res://src/images/panorama/sunset_city.png" id="4_n1yad"]
[ext_resource type="Shader" uid="uid://crclnnrqddewa" path="res://src/shaders/panorama/depth.gdshader" id="4_qaqf1"]
[ext_resource type="PackedScene" uid="uid://c8bnpo28a373g" path="res://src/systems/camera/camera.tscn" id="6_ev3dy"]
[ext_resource type="PackedScene" uid="uid://jioru3rh3jtn" path="res://src/levels/_real/apartment/balcony_real.tscn" id="7_33y2f"]
[ext_resource type="PackedScene" uid="uid://dp6063trlnao1" path="res://src/levels/_real/apartment/room_real.tscn" id="8_kxofn"]
[ext_resource type="Script" uid="uid://f4sb25g3gpic" path="res://src/systems/sequencing/sequence/game/sequence_region.gd" id="8_njcb1"]
[ext_resource type="Script" uid="uid://bau5lvtg1mbkj" path="res://src/systems/interaction/door_inscene.gd" id="9_xma33"]
[ext_resource type="PackedScene" uid="uid://ryhx8o46er7i" path="res://src/player/2D/madotsuki/madotsuki.tscn" id="10_p0cyb"]
[ext_resource type="Script" uid="uid://ofyfa3d6ql28" path="res://src/systems/components/independent/spawn_point.gd" id="10_rxu3j"]
[ext_resource type="Script" uid="uid://bxh774473av7t" path="res://src/systems/interaction/base_interactable.gd" id="12_rbx1l"]
[ext_resource type="Script" uid="uid://bkadpjx8csm75" path="res://src/systems/sequencing/sequence/game/on_interact.gd" id="13_4kjpi"]
[ext_resource type="Script" uid="uid://c1od80bn28h0l" path="res://src/systems/sequencing/sequence_interface.gd" id="13_160am"]
[ext_resource type="PackedScene" uid="uid://be7r3txtdvb20" path="res://src/levels/__ignore/rain.tscn" id="13_l6oh8"]
[ext_resource type="Script" uid="uid://dspsbq33tl0wa" path="res://src/systems/sequencing/event/game/invoke_game_event.gd" id="14_fjdyw"]
[ext_resource type="Script" uid="uid://d4mfbplpq5p5d" path="res://src/systems/sequencing/event/game/screen_transition.gd" id="15_l7mt1"]
[ext_resource type="Script" uid="uid://ctqw6a8qsvnv4" path="res://src/systems/sequencing/event/audio/play_music.gd" id="15_lejej"]
[ext_resource type="Script" uid="uid://0v2nidb8jsha" path="res://src/systems/sequencing/event_interface.gd" id="16_ohce6"]
[ext_resource type="AudioStream" uid="uid://ciq7lkhql6pga" path="res://src/audio/bgm/may_yta_hmm.ogg" id="16_sau16"]
[ext_resource type="AudioStream" uid="uid://dlfw10qwka7su" path="res://src/audio/amb/amb_rain.ogg" id="17_sau16"]
[ext_resource type="Script" uid="uid://d1ojbn5jneejv" path="res://src/systems/sequencing/event/node/set_property.gd" id="17_t2xer"]
[ext_resource type="Script" uid="uid://cvb48ow8p04j8" path="res://src/systems/sequencing/event/call_external_event.gd" id="17_vphfh"]
[ext_resource type="Script" uid="uid://dbqq6d85qilns" path="res://src/systems/sequencing/event/camera/change_target.gd" id="18_4kjpi"]
[ext_resource type="Script" uid="uid://dxx2gbg56i1ts" path="res://src/systems/sequencing/event/scene/apply_panorama.gd" id="18_jd4xj"]
[ext_resource type="AudioStream" uid="uid://daa4fj15uaf4j" path="res://src/audio/amb/amb_rain_muffle.ogg" id="18_vphfh"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_p0cyb"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_l6oh8"]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_eqyao"]
size = Vector2(16, 16)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_8p0b5"]
size = Vector2(480, 270)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_6pphd"]
size = Vector2(16, 32)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_777kg"]
size = Vector2(16, 32)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_xma33"]
size = Vector2(480, 270)

[sub_resource type="ShaderMaterial" id="ShaderMaterial_4gftm"]
shader = ExtResource("4_qaqf1")
shader_parameter/initial_uv_offset = Vector2(0, 0)
shader_parameter/snapped_val = 0.0016
shader_parameter/offset_strength = 0.0
shader_parameter/offset_strength_influence = Vector2(1, 1)
shader_parameter/overlay_modulate = Color(0, 0, 0, 1)
shader_parameter/transparency = 0.0

[node name="room" type="Node2D" node_paths=PackedStringArray("seq_initial", "seq_free", "scene_objects")]
y_sort_enabled = true
script = ExtResource("1_gl3nc")
seq_initial = NodePath("on_initial")
seq_free = NodePath("on_free")
scene_objects = [NodePath("on_initial"), NodePath("on_free")]
load_transition = SubResource("ShaderMaterial_p0cyb")
unload_transition = SubResource("ShaderMaterial_l6oh8")
metadata/_custom_type_script = "uid://b1ofr4umso5jf"

[node name="camera" parent="." node_paths=PackedStringArray("initial_target") instance=ExtResource("6_ev3dy")]
position = Vector2(184, 160)
initial_target = NodePath("../balcony/_/madotsuki")

[node name="balcony" parent="." instance=ExtResource("7_33y2f")]
position = Vector2(80, -8)

[node name="madotsuki" parent="balcony/_" index="4" instance=ExtResource("10_p0cyb")]
position = Vector2(104, 168)
metadata/_custom_type_script = "uid://bau5lvtg1mbkj"

[node name="to_room" type="Area2D" parent="balcony/_" index="5" node_paths=PackedStringArray("spawn_point", "target_door", "rect")]
position = Vector2(104, 144)
collision_layer = 2684354560
collision_mask = 2684354560
script = ExtResource("9_xma33")
spawn_point = NodePath("spawn_point")
target_door = NodePath("../../../room/to_balcony")
parallel = true
secret = true
area = true
rect = NodePath("rect")
metadata/_custom_type_script = "uid://bau5lvtg1mbkj"

[node name="rect" type="CollisionShape2D" parent="balcony/_/to_room"]
position = Vector2(0, -8)
shape = SubResource("RectangleShape2D_eqyao")
debug_color = Color(0.2, 0, 0.7, 0.2)

[node name="spawn_point" type="Node2D" parent="balcony/_/to_room" node_paths=PackedStringArray("parent_instead_of_self")]
position = Vector2(0, 8)
script = ExtResource("10_rxu3j")
parent_instead_of_self = NodePath("../../..")

[node name="deadzone" type="Area2D" parent="balcony/_" index="6" node_paths=PackedStringArray("rect")]
position = Vector2(168, 144)
collision_layer = 1073741824
collision_mask = 1073741824
script = ExtResource("4_jd4xj")
rect = NodePath("rect")
presence_detect = true
metadata/_custom_type_script = "uid://btgm8okupfro7"

[node name="rect" type="CollisionShape2D" parent="balcony/_/deadzone"]
shape = SubResource("RectangleShape2D_8p0b5")
debug_color = Color(0.2, 0, 0.7, 0.2)

[node name="in_balcony" type="Node" parent="balcony/_/deadzone" node_paths=PackedStringArray("enter_sequence", "exit_sequence")]
process_mode = 4
script = ExtResource("8_njcb1")
enter_sequence = NodePath("enter")
exit_sequence = NodePath("exit")
metadata/_custom_type_script = "uid://f4sb25g3gpic"

[node name="enter" type="Node" parent="balcony/_/deadzone/in_balcony"]
script = ExtResource("13_160am")

[node name="amb" type="Node" parent="balcony/_/deadzone/in_balcony/enter" node_paths=PackedStringArray("event")]
script = ExtResource("17_vphfh")
event = NodePath("../../../../../../play_rain_amb")
metadata/_custom_type_script = "uid://0v2nidb8jsha"

[node name="exit" type="Node" parent="balcony/_/deadzone/in_balcony"]
script = ExtResource("13_160am")

[node name="room" parent="." instance=ExtResource("8_kxofn")]
position = Vector2(88, -280)

[node name="request_cutscene_end" parent="room/note/OnInteract" index="2"]
event_id = "CUTSCENE_END_REQUEST"

[node name="aniimation_ui" type="CanvasLayer" parent="room"]

[node name="Sprite2D" type="Sprite2D" parent="room/aniimation_ui"]

[node name="cutscene" type="AnimationPlayer" parent="room"]

[node name="to_balcony" type="Area2D" parent="room" node_paths=PackedStringArray("spawn_point", "target_door", "rect")]
position = Vector2(152, 184)
collision_layer = 2684354560
collision_mask = 2684354560
script = ExtResource("9_xma33")
spawn_point = NodePath("spawn_point")
target_door = NodePath("../../balcony/_/to_room")
parallel = true
secret = true
area = true
rect = NodePath("rect")
metadata/_custom_type_script = "uid://bau5lvtg1mbkj"

[node name="rect" type="CollisionShape2D" parent="room/to_balcony"]
position = Vector2(0, 8)
shape = SubResource("RectangleShape2D_6pphd")
debug_color = Color(0.2, 0, 0.7, 0.2)

[node name="spawn_point" type="Node2D" parent="room/to_balcony" node_paths=PackedStringArray("parent_instead_of_self")]
position = Vector2(0, -16)
script = ExtResource("10_rxu3j")
parent_instead_of_self = NodePath("../../../balcony")

[node name="bed" type="Area2D" parent="room" node_paths=PackedStringArray("rect")]
position = Vector2(232, 96)
collision_layer = 2147483648
collision_mask = 2147483648
script = ExtResource("12_rbx1l")
rect = NodePath("rect")
metadata/_custom_type_script = "uid://bxh774473av7t"

[node name="rect" type="CollisionShape2D" parent="room/bed"]
shape = SubResource("RectangleShape2D_777kg")
debug_color = Color(0.2, 0, 0.7, 0.2)

[node name="OnInteract" type="Node" parent="room/bed"]
script = ExtResource("13_4kjpi")
metadata/_custom_type_script = "uid://bkadpjx8csm75"

[node name="request_cutscene_start" type="Node" parent="room/bed/OnInteract"]
script = ExtResource("14_fjdyw")
event_id = "CUTSCENE_START_REQUEST"
metadata/_custom_type_script = "uid://dspsbq33tl0wa"

[node name="fade_in" type="Node" parent="room/bed/OnInteract"]
script = ExtResource("15_l7mt1")
metadata/_custom_type_script = "uid://0v2nidb8jsha"

[node name="play_sound_foley" type="Node" parent="room/bed/OnInteract"]
script = ExtResource("16_ohce6")
metadata/_custom_type_script = "uid://0v2nidb8jsha"

[node name="set_player_inactive" type="Node" parent="room/bed/OnInteract"]
process_mode = 4
script = ExtResource("17_t2xer")
metadata/_custom_type_script = "uid://0v2nidb8jsha"

[node name="set_player_invisible" type="Node" parent="room/bed/OnInteract"]
process_mode = 4
script = ExtResource("17_t2xer")
metadata/_custom_type_script = "uid://0v2nidb8jsha"

[node name="change_cam_target" type="Node" parent="room/bed/OnInteract" node_paths=PackedStringArray("target")]
script = ExtResource("18_4kjpi")
target = NodePath("../..")
metadata/_custom_type_script = "uid://0v2nidb8jsha"

[node name="fade_out" type="Node" parent="room/bed/OnInteract"]
script = ExtResource("15_l7mt1")
metadata/_custom_type_script = "uid://0v2nidb8jsha"

[node name="request_cutscene_end" type="Node" parent="room/bed/OnInteract"]
script = ExtResource("14_fjdyw")
event_id = "CUTSCENE_START_END"
metadata/_custom_type_script = "uid://dspsbq33tl0wa"

[node name="deadzone" type="Area2D" parent="room" node_paths=PackedStringArray("rect")]
position = Vector2(160, 104)
collision_layer = 1610612736
collision_mask = 1610612736
script = ExtResource("4_jd4xj")
rect = NodePath("rect")
presence_detect = true
metadata/_custom_type_script = "uid://btgm8okupfro7"

[node name="rect" type="CollisionShape2D" parent="room/deadzone"]
shape = SubResource("RectangleShape2D_xma33")
debug_color = Color(0.2, 0, 0.7, 0.2)

[node name="in_room" type="Node" parent="room/deadzone" node_paths=PackedStringArray("enter_sequence", "exit_sequence")]
process_mode = 4
script = ExtResource("8_njcb1")
enter_sequence = NodePath("enter")
exit_sequence = NodePath("exit")
metadata/_custom_type_script = "uid://f4sb25g3gpic"

[node name="enter" type="Node" parent="room/deadzone/in_room"]
script = ExtResource("13_160am")

[node name="amb_muffle" type="Node" parent="room/deadzone/in_room/enter" node_paths=PackedStringArray("event")]
script = ExtResource("17_vphfh")
event = NodePath("../../../../../play_rain_amb_muffle")
metadata/_custom_type_script = "uid://0v2nidb8jsha"

[node name="exit" type="Node" parent="room/deadzone/in_room"]
script = ExtResource("13_160am")

[node name="rain" parent="." instance=ExtResource("13_l6oh8")]
position = Vector2(208, -16)
amount = 25
lifetime = 0.88
initial_velocity_min = 450.0
initial_velocity_max = 450.0

[node name="on_initial" type="Node" parent="."]
script = ExtResource("13_160am")

[node name="panorama (top_layer)" type="SubViewport" parent="on_initial"]
process_mode = 4
canvas_item_default_texture_filter = 0
canvas_item_default_texture_repeat = 2
size = Vector2i(480, 270)
size_2d_override = Vector2i(480, 270)
script = ExtResource("18_jd4xj")

[node name="Dusk" type="Sprite2D" parent="on_initial/panorama (top_layer)"]
material = SubResource("ShaderMaterial_4gftm")
position = Vector2(280, 88)
texture = ExtResource("4_n1yad")

[node name="Background" type="Sprite2D" parent="on_initial/panorama (top_layer)"]
position = Vector2(248, 128)
texture = ExtResource("4_kxofn")

[node name="BGM" type="Node" parent="on_initial"]
script = ExtResource("15_lejej")
stream = ExtResource("16_sau16")
pitch = 0.7
metadata/_custom_type_script = "uid://0v2nidb8jsha"

[node name="on_free" type="Node" parent="."]
script = ExtResource("13_160am")

[node name="play_rain_amb_muffle" type="Node" parent="."]
script = ExtResource("15_lejej")
music_bus = 1
stream = ExtResource("18_vphfh")
metadata/_custom_type_script = "uid://c1od80bn28h0l"

[node name="play_rain_amb" type="Node" parent="."]
script = ExtResource("15_lejej")
music_bus = 1
stream = ExtResource("17_sau16")
metadata/_custom_type_script = "uid://c1od80bn28h0l"

[editable path="camera"]
[editable path="balcony"]
[editable path="room"]
