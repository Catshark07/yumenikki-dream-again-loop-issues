[gd_scene load_steps=28 format=3 uid="uid://brd2skoctkkxe"]

[ext_resource type="Script" uid="uid://b1ofr4umso5jf" path="res://src/systems/scenes/game/game_scene.gd" id="1_ids3t"]
[ext_resource type="Script" uid="uid://c1od80bn28h0l" path="res://src/systems/sequencing/sequence_interface.gd" id="6_7pixw"]
[ext_resource type="Script" uid="uid://dspsbq33tl0wa" path="res://src/systems/sequencing/event/game/invoke_game_event.gd" id="8_d0p7m"]
[ext_resource type="Texture2D" uid="uid://bi6eonsejp6ma" path="res://src/player/sigil.png" id="9_5mwt8"]
[ext_resource type="AudioStream" uid="uid://b4ccjxsuwusfl" path="res://src/audio/bgm/2kki_zaza.wav" id="9_a27ul"]
[ext_resource type="Script" uid="uid://dxx2gbg56i1ts" path="res://src/systems/sequencing/event/scene/apply_panorama.gd" id="10_27xdc"]
[ext_resource type="Script" uid="uid://bnajku7ggsr2q" path="res://src/systems/world_loop/loopable_component.gd" id="11_5mwt8"]
[ext_resource type="Script" uid="uid://ctqw6a8qsvnv4" path="res://src/systems/sequencing/event/audio/play_bgm.gd" id="11_44x1d"]
[ext_resource type="Shader" uid="uid://dqxrs4a4y611c" path="res://src/shaders/panorama/linear.gdshader" id="11_d0p7m"]
[ext_resource type="PackedScene" uid="uid://c8bnpo28a373g" path="res://src/systems/camera/camera.tscn" id="12_d0p7m"]
[ext_resource type="Texture2D" uid="uid://bhfp4xsgl4dhe" path="res://src/images/panorama/2kki_nexus.png" id="12_p2qgu"]
[ext_resource type="PackedScene" uid="uid://ryhx8o46er7i" path="res://src/player/2D/madotsuki/madotsuki.tscn" id="13_p2qgu"]
[ext_resource type="Script" uid="uid://bxh774473av7t" path="res://src/systems/interaction/base_interactable.gd" id="15_8rh84"]
[ext_resource type="Script" uid="uid://jf85vmwx4pj" path="res://src/player/2D/scripts/pl_variables.gd" id="16_7j243"]
[ext_resource type="Texture2D" uid="uid://cj4o4xfwroiwk" path="res://src/player/hud/clock.png" id="16_7pixw"]
[ext_resource type="Script" uid="uid://desxt7tbq37sf" path="res://src/systems/world_loop/loop_manager.gd" id="16_syomr"]
[ext_resource type="Script" uid="uid://bkadpjx8csm75" path="res://src/systems/sequencing/sequence/game/on_interact.gd" id="17_hq78p"]
[ext_resource type="Script" uid="uid://bueabxwtsde8h" path="res://src/systems/sequencing/event/message/open_message.gd" id="18_54gce"]
[ext_resource type="Script" uid="uid://vk574kc3l7av" path="res://src/systems/sequencing/event/audio/play_sound.gd" id="19_wwmjk"]
[ext_resource type="AudioStream" uid="uid://d1oaiyge765ei" path="res://src/audio/se/voice_mado_no-1.WAV" id="20_0n5dl"]
[ext_resource type="AudioStream" uid="uid://cud60igddic07" path="res://src/audio/se/voice_mado_no-2.WAV" id="21_44x1d"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_kciqk"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_f6176"]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_31k7y"]
size = Vector2(500, 500)

[sub_resource type="ShaderMaterial" id="ShaderMaterial_7ahcf"]
shader = ExtResource("11_d0p7m")
shader_parameter/dirX = 1.0
shader_parameter/dirY = 1.0
shader_parameter/scroll_speed = 0.02999999932944
shader_parameter/initial_uv_offset = Vector2(0, 0)
shader_parameter/snapped_val = 0.0016
shader_parameter/offset_strength = 0.12
shader_parameter/offset_strength_influence = Vector2(1, 1)

[sub_resource type="Resource" id="Resource_8rh84"]
resource_local_to_scene = true
resource_name = "pl_variables"
script = ExtResource("16_7j243")
can_sprint = false
metadata/_custom_type_script = "uid://bxe7uci7t77tx"

[sub_resource type="RectangleShape2D" id="RectangleShape2D_jpxu1"]
size = Vector2(16, 16)

[node name="GameScene" type="Node" node_paths=PackedStringArray("seq_initial", "scene_objects")]
script = ExtResource("1_ids3t")
seq_initial = NodePath("on_initial")
scene_objects = [NodePath("on_initial")]
load_transition = SubResource("ShaderMaterial_kciqk")
unload_transition = SubResource("ShaderMaterial_f6176")
metadata/_custom_type_script = "uid://b1ofr4umso5jf"

[node name="Node" type="Node2D" parent="."]

[node name="Node2D" type="Node2D" parent="Node"]

[node name="Sprite2D" type="Sprite2D" parent="Node/Node2D"]
texture = ExtResource("9_5mwt8")

[node name="LoopableComponent" type="Node2D" parent="Node/Node2D" node_paths=PackedStringArray("manager", "target", "dupe_nodes")]
script = ExtResource("11_5mwt8")
manager = NodePath("../../../LoopManager")
target = NodePath("..")
dupe_nodes = [NodePath("loop_Node2D_0"), NodePath("loop_Node2D_1"), NodePath("loop_Node2D_2"), NodePath("loop_Node2D_3"), NodePath("loop_Node2D_4"), NodePath("loop_Node2D_5"), NodePath("loop_Node2D_6"), NodePath("loop_Node2D_7")]
metadata/_custom_type_script = "uid://bnajku7ggsr2q"

[node name="loop_Node2D_0" type="Node2D" parent="Node/Node2D/LoopableComponent"]

[node name="loop_Node2D_1" type="Node2D" parent="Node/Node2D/LoopableComponent"]

[node name="Sprite2D" type="Sprite2D" parent="Node/Node2D/LoopableComponent/loop_Node2D_1"]
texture = ExtResource("9_5mwt8")

[node name="loop_Node2D_2" type="Node2D" parent="Node/Node2D/LoopableComponent"]

[node name="Sprite2D" type="Sprite2D" parent="Node/Node2D/LoopableComponent/loop_Node2D_2"]
texture = ExtResource("9_5mwt8")

[node name="loop_Node2D_3" type="Node2D" parent="Node/Node2D/LoopableComponent"]

[node name="Sprite2D" type="Sprite2D" parent="Node/Node2D/LoopableComponent/loop_Node2D_3"]
texture = ExtResource("9_5mwt8")

[node name="loop_Node2D_4" type="Node2D" parent="Node/Node2D/LoopableComponent"]

[node name="Sprite2D" type="Sprite2D" parent="Node/Node2D/LoopableComponent/loop_Node2D_4"]
texture = ExtResource("9_5mwt8")

[node name="loop_Node2D_5" type="Node2D" parent="Node/Node2D/LoopableComponent"]

[node name="Sprite2D" type="Sprite2D" parent="Node/Node2D/LoopableComponent/loop_Node2D_5"]
texture = ExtResource("9_5mwt8")

[node name="loop_Node2D_6" type="Node2D" parent="Node/Node2D/LoopableComponent"]

[node name="Sprite2D" type="Sprite2D" parent="Node/Node2D/LoopableComponent/loop_Node2D_6"]
texture = ExtResource("9_5mwt8")

[node name="loop_Node2D_7" type="Node2D" parent="Node/Node2D/LoopableComponent"]

[node name="Sprite2D" type="Sprite2D" parent="Node/Node2D/LoopableComponent/loop_Node2D_7"]
texture = ExtResource("9_5mwt8")

[node name="LoopManager" type="Node" parent="." node_paths=PackedStringArray("loop_objects", "loop_objects_detect", "shape_detect")]
script = ExtResource("16_syomr")
loop_objects = [null]
world_size = Vector2(500, 500)
loop_objects_detect = NodePath("loop_objects_detect")
shape_detect = NodePath("loop_objects_detect/detect_shape")
metadata/_custom_type_script = "uid://desxt7tbq37sf"

[node name="loop_objects_detect" type="Area2D" parent="LoopManager"]
collision_mask = 64

[node name="detect_shape" type="CollisionShape2D" parent="LoopManager/loop_objects_detect"]
shape = SubResource("RectangleShape2D_31k7y")

[node name="camera_handler" parent="." instance=ExtResource("12_d0p7m")]
position = Vector2(48, -48)

[node name="on_initial" type="Node" parent="." node_paths=PackedStringArray("order", "front", "back")]
script = ExtResource("6_7pixw")
order = [NodePath("dream"), NodePath("parallax"), NodePath("Event2")]
front = NodePath("dream")
back = NodePath("Event2")

[node name="dream" type="Node" parent="on_initial" node_paths=PackedStringArray("next")]
script = ExtResource("8_d0p7m")
event_id = "OVERRIDE_TO_DREAM_STATE"
next = NodePath("../parallax")
metadata/_custom_type_script = "uid://0v2nidb8jsha"

[node name="parallax" type="SubViewport" parent="on_initial" node_paths=PackedStringArray("prev", "next")]
own_world_3d = true
transparent_bg = true
canvas_item_default_texture_filter = 0
canvas_item_default_texture_repeat = 2
size = Vector2i(480, 270)
size_2d_override = Vector2i(480, 270)
script = ExtResource("10_27xdc")
prev = NodePath("../dream")
next = NodePath("../Event2")

[node name="TextureRect" type="TextureRect" parent="on_initial/parallax"]
material = SubResource("ShaderMaterial_7ahcf")
offset_right = 40.0
offset_bottom = 40.0
texture = ExtResource("12_p2qgu")

[node name="Event2" type="Node" parent="on_initial" node_paths=PackedStringArray("prev")]
script = ExtResource("11_44x1d")
stream = ExtResource("9_a27ul")
prev = NodePath("../parallax")
metadata/_custom_type_script = "uid://0v2nidb8jsha"

[node name="madotsuki" parent="." instance=ExtResource("13_p2qgu")]
position = Vector2(16, 32)
values = SubResource("Resource_8rh84")

[node name="Interactable" type="Area2D" parent="." node_paths=PackedStringArray("rect")]
collision_layer = 0
collision_mask = 0
script = ExtResource("15_8rh84")
rect = NodePath("rect")
metadata/_custom_type_script = "uid://bxh774473av7t"

[node name="rect" type="CollisionShape2D" parent="Interactable"]
shape = SubResource("RectangleShape2D_jpxu1")
debug_color = Color(0.2, 0, 0.7, 0.2)

[node name="Sprite2D" type="Sprite2D" parent="Interactable"]
texture = ExtResource("16_7pixw")

[node name="OnInteract" type="Node" parent="Interactable" node_paths=PackedStringArray("order", "front", "back")]
process_mode = 4
script = ExtResource("17_hq78p")
order = [NodePath("Sequence"), NodePath("Sequence2"), NodePath("Sequence3"), NodePath("Sequence4")]
front = NodePath("Sequence")
back = NodePath("Sequence4")
metadata/_custom_type_script = "uid://bkadpjx8csm75"

[node name="Sequence" type="Node" parent="Interactable/OnInteract" node_paths=PackedStringArray("order", "front", "back", "next")]
script = ExtResource("6_7pixw")
order = [NodePath("message_1"), NodePath("message_2")]
front = NodePath("message_1")
back = NodePath("message_2")
next = NodePath("../Sequence2")
metadata/_custom_type_script = "uid://c1od80bn28h0l"

[node name="message_1" type="Node" parent="Interactable/OnInteract/Sequence" node_paths=PackedStringArray("next")]
script = ExtResource("18_54gce")
texts = PackedStringArray("hi")
next = NodePath("../message_2")
metadata/_custom_type_script = "uid://0v2nidb8jsha"

[node name="message_2" type="Node" parent="Interactable/OnInteract/Sequence" node_paths=PackedStringArray("prev")]
script = ExtResource("18_54gce")
texts = PackedStringArray("bye")
prev = NodePath("../message_1")
metadata/_custom_type_script = "uid://0v2nidb8jsha"

[node name="Sequence2" type="Node" parent="Interactable/OnInteract" node_paths=PackedStringArray("order", "front", "back", "prev", "next")]
script = ExtResource("6_7pixw")
order = [NodePath("audio_1"), NodePath("audio_2")]
front = NodePath("audio_1")
back = NodePath("audio_2")
prev = NodePath("../Sequence")
next = NodePath("../Sequence3")
metadata/_custom_type_script = "uid://c1od80bn28h0l"

[node name="audio_1" type="Node" parent="Interactable/OnInteract/Sequence2" node_paths=PackedStringArray("next")]
script = ExtResource("19_wwmjk")
sound = ExtResource("20_0n5dl")
next = NodePath("../audio_2")
metadata/_custom_type_script = "uid://0v2nidb8jsha"

[node name="audio_2" type="Node" parent="Interactable/OnInteract/Sequence2" node_paths=PackedStringArray("prev")]
script = ExtResource("19_wwmjk")
sound = ExtResource("21_44x1d")
prev = NodePath("../audio_1")
metadata/_custom_type_script = "uid://0v2nidb8jsha"

[node name="Sequence3" type="Node" parent="Interactable/OnInteract" node_paths=PackedStringArray("order", "front", "back", "prev", "next")]
script = ExtResource("6_7pixw")
order = [NodePath("message_1"), NodePath("message_2")]
front = NodePath("message_1")
back = NodePath("message_2")
prev = NodePath("../Sequence2")
next = NodePath("../Sequence4")
metadata/_custom_type_script = "uid://c1od80bn28h0l"

[node name="message_1" type="Node" parent="Interactable/OnInteract/Sequence3" node_paths=PackedStringArray("next")]
script = ExtResource("18_54gce")
texts = PackedStringArray("hiasdasd")
next = NodePath("../message_2")
metadata/_custom_type_script = "uid://0v2nidb8jsha"

[node name="message_2" type="Node" parent="Interactable/OnInteract/Sequence3" node_paths=PackedStringArray("prev")]
script = ExtResource("18_54gce")
texts = PackedStringArray("byeddddd")
prev = NodePath("../message_1")
metadata/_custom_type_script = "uid://0v2nidb8jsha"

[node name="Sequence4" type="Node" parent="Interactable/OnInteract" node_paths=PackedStringArray("order", "front", "back", "prev")]
script = ExtResource("6_7pixw")
order = [NodePath("audio_1"), NodePath("audio_2")]
front = NodePath("audio_1")
back = NodePath("audio_2")
prev = NodePath("../Sequence3")
metadata/_custom_type_script = "uid://c1od80bn28h0l"

[node name="audio_1" type="Node" parent="Interactable/OnInteract/Sequence4" node_paths=PackedStringArray("next")]
script = ExtResource("19_wwmjk")
sound = ExtResource("20_0n5dl")
pitch = 0.63
next = NodePath("../audio_2")
metadata/_custom_type_script = "uid://0v2nidb8jsha"

[node name="audio_2" type="Node" parent="Interactable/OnInteract/Sequence4" node_paths=PackedStringArray("prev")]
script = ExtResource("19_wwmjk")
sound = ExtResource("21_44x1d")
pitch = 1.11
prev = NodePath("../audio_1")
metadata/_custom_type_script = "uid://0v2nidb8jsha"
