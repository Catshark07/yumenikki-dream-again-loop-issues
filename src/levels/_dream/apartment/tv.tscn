[gd_scene load_steps=18 format=3 uid="uid://cnbg0ato50rwn"]

[ext_resource type="Script" uid="uid://bxh774473av7t" path="res://src/systems/interaction/interactable.gd" id="1_q7565"]
[ext_resource type="Texture2D" uid="uid://b5c33hi62qlav" path="res://src/levels/_dream/apartment/tv.png" id="2_fk1p2"]
[ext_resource type="Script" uid="uid://dlvvx5cthl4bp" path="res://src/systems/utils/spritesheet_formatter.gd" id="3_528yx"]
[ext_resource type="Script" uid="uid://bkadpjx8csm75" path="res://src/systems/sequencing/sequence/game/on_interact.gd" id="4_1ypmp"]
[ext_resource type="Script" uid="uid://vk574kc3l7av" path="res://src/systems/sequencing/event/audio/play_sound.gd" id="5_mta7w"]
[ext_resource type="Script" uid="uid://b6ilkvabn22lp" path="res://src/systems/sequencing/sequence/conditional/if_expression.gd" id="5_qvd66"]
[ext_resource type="Script" uid="uid://0li2ud4tbkf5" path="res://src/systems/scenes/custom_properties.gd" id="7_imcer"]
[ext_resource type="AudioStream" uid="uid://cqilmcra7j516" path="res://src/audio/se/tv_tinny_noise.wav" id="7_qvd66"]
[ext_resource type="Script" uid="uid://c1od80bn28h0l" path="res://src/systems/sequencing/sequence_interface.gd" id="8_22b6d"]
[ext_resource type="Script" uid="uid://d1ojbn5jneejv" path="res://src/systems/sequencing/event/node/set_property.gd" id="8_imcer"]
[ext_resource type="Script" uid="uid://dyaslht461mw2" path="res://src/systems/sequencing/event/game/wait_seconds.gd" id="9_imcer"]
[ext_resource type="Script" uid="uid://ceoifexmpm3o5" path="res://src/systems/sequencing/event/node/call_function.gd" id="10_qvd66"]
[ext_resource type="AudioStream" uid="uid://bdb2pq8lp27t6" path="res://src/audio/se/tv_turn_off.wav" id="12_xlbse"]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_a47do"]
size = Vector2(16, 16)

[sub_resource type="Animation" id="Animation_qvd66"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("tv:progress")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [0]
}

[sub_resource type="Animation" id="Animation_xlbse"]
resource_name = "static"
length = 0.08
loop_mode = 1
step = 0.02
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("tv:progress")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.04),
"transitions": PackedFloat32Array(1, 1),
"update": 1,
"values": [1, 2]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_v2ehy"]
_data = {
&"RESET": SubResource("Animation_qvd66"),
&"static": SubResource("Animation_xlbse")
}

[node name="tv_interactable" type="Area2D" node_paths=PackedStringArray("rect")]
process_mode = 3
collision_layer = 2147483650
collision_mask = 2147483648
script = ExtResource("1_q7565")
rect = NodePath("rect")
metadata/_custom_type_script = "uid://bxh774473av7t"

[node name="tv" type="Sprite2D" parent="."]
position = Vector2(0, 12)
texture = ExtResource("2_fk1p2")
hframes = 3
script = ExtResource("3_528yx")
frame_dimensions = Vector2i(32, 32)
frame_h_count = 3

[node name="rect" type="CollisionShape2D" parent="."]
position = Vector2(0, 12)
shape = SubResource("RectangleShape2D_a47do")
debug_color = Color(0.2, 0, 0.7, 0.2)

[node name="coll" type="StaticBody2D" parent="."]
position = Vector2(0, 12)

[node name="shape" type="CollisionPolygon2D" parent="coll"]
polygon = PackedVector2Array(-8, 8, 4, 4, 8, 8, -4, 12)

[node name="on_interact" type="Node" parent="." node_paths=PackedStringArray("order", "front", "back")]
script = ExtResource("4_1ypmp")
order = [NodePath("if_tv_off")]
front = NodePath("if_tv_off")
back = NodePath("if_tv_off")
metadata/_custom_type_script = "uid://bkadpjx8csm75"

[node name="if_tv_off" type="Node" parent="on_interact" node_paths=PackedStringArray("input_objects", "if_true", "if_false")]
process_mode = 4
script = ExtResource("5_qvd66")
expression = "!tv.properties[\"tv_on\"]"
input_objects = {
"tv": NodePath("../../properties")
}
if_true = NodePath("if_true")
if_false = NodePath("if_false")
metadata/_custom_type_script = "uid://br7tiv3hm32fy"

[node name="if_true" type="Node" parent="on_interact/if_tv_off" node_paths=PackedStringArray("order", "front", "back")]
script = ExtResource("8_22b6d")
order = [NodePath("play_on"), NodePath("mark_as_on"), NodePath("show_eye"), NodePath("wait_half_sec"), NodePath("play_animation")]
front = NodePath("play_on")
back = NodePath("play_animation")
custom_linked_pointers = true

[node name="play_on" type="Node" parent="on_interact/if_tv_off/if_true" node_paths=PackedStringArray("next")]
process_mode = 4
script = ExtResource("5_mta7w")
sound = ExtResource("7_qvd66")
wait_til_finished = false
next = NodePath("../mark_as_on")
metadata/_custom_type_script = "uid://vk574kc3l7av"

[node name="mark_as_on" type="Node" parent="on_interact/if_tv_off/if_true" node_paths=PackedStringArray("node", "prev", "next")]
script = ExtResource("8_imcer")
node = NodePath("../../../../properties")
property_name = "properties"
property_info = {
"class_name": &"",
"hint": 23,
"hint_string": "4:;0:",
"name": "properties",
"type": 27,
"usage": 4102
}
property_value = Dictionary[String, Variant]({
"tv_on": false
})
new_value = Dictionary[String, Variant]({
"tv_on": true
})
prev = NodePath("../play_on")
next = NodePath("../show_eye")
metadata/_custom_type_script = "uid://0v2nidb8jsha"

[node name="show_eye" type="Node" parent="on_interact/if_tv_off/if_true" node_paths=PackedStringArray("node", "prev", "next")]
script = ExtResource("8_imcer")
node = NodePath("../../../../tv")
property_name = "progress"
property_info = {
"class_name": &"",
"hint": 0,
"hint_string": "",
"name": "progress",
"type": 2,
"usage": 4102
}
property_value = 0
new_value = 1
prev = NodePath("../mark_as_on")
next = NodePath("../wait_half_sec")
metadata/_custom_type_script = "uid://0v2nidb8jsha"

[node name="wait_half_sec" type="Node" parent="on_interact/if_tv_off/if_true" node_paths=PackedStringArray("prev", "next")]
script = ExtResource("9_imcer")
seconds = 0.5
prev = NodePath("../show_eye")
next = NodePath("../play_animation")
metadata/_custom_type_script = "uid://0v2nidb8jsha"

[node name="play_animation" type="Node" parent="on_interact/if_tv_off/if_true" node_paths=PackedStringArray("node", "prev")]
script = ExtResource("10_qvd66")
node = NodePath("../../../../looped_animation")
method_name = "play"
method_info = {
"args": Array[Dictionary]([{
"class_name": &"",
"hint": 0,
"hint_string": "",
"name": "name",
"type": 21,
"usage": 6
}, {
"class_name": &"",
"hint": 0,
"hint_string": "",
"name": "custom_blend",
"type": 3,
"usage": 6
}, {
"class_name": &"",
"hint": 0,
"hint_string": "",
"name": "custom_speed",
"type": 3,
"usage": 6
}, {
"class_name": &"",
"hint": 0,
"hint_string": "",
"name": "from_end",
"type": 1,
"usage": 6
}]),
"default_args": [&"", -1, 1.0, false],
"flags": 1,
"id": 6778,
"name": "play",
"return": {
"class_name": &"",
"hint": 0,
"hint_string": "",
"name": "",
"type": 0,
"usage": 6
}
}
internal_args = Dictionary[String, Variant]({
"name": &"static"
})
prev = NodePath("../wait_half_sec")
metadata/_custom_type_script = "uid://0v2nidb8jsha"

[node name="if_false" type="Node" parent="on_interact/if_tv_off" node_paths=PackedStringArray("order", "front", "back")]
script = ExtResource("8_22b6d")
order = [NodePath("stop"), NodePath("hide_eye"), NodePath("play_off"), NodePath("mark_as_off")]
front = NodePath("stop")
back = NodePath("mark_as_off")
custom_linked_pointers = true

[node name="stop" type="Node" parent="on_interact/if_tv_off/if_false" node_paths=PackedStringArray("node", "next")]
script = ExtResource("10_qvd66")
node = NodePath("../../../../looped_animation")
method_name = "stop"
method_info = {
"args": Array[Dictionary]([{
"class_name": &"",
"hint": 0,
"hint_string": "",
"name": "keep_state",
"type": 1,
"usage": 6
}]),
"default_args": [false],
"flags": 1,
"id": 6786,
"name": "stop",
"return": {
"class_name": &"",
"hint": 0,
"hint_string": "",
"name": "",
"type": 0,
"usage": 6
}
}
internal_args = Dictionary[String, Variant]({})
next = NodePath("../hide_eye")
metadata/_custom_type_script = "uid://0v2nidb8jsha"

[node name="hide_eye" type="Node" parent="on_interact/if_tv_off/if_false" node_paths=PackedStringArray("node", "prev", "next")]
script = ExtResource("8_imcer")
node = NodePath("../../../../tv")
property_name = "progress"
property_info = {
"class_name": &"",
"hint": 0,
"hint_string": "",
"name": "progress",
"type": 2,
"usage": 4102
}
property_value = 0
new_value = 0
prev = NodePath("../stop")
next = NodePath("../play_off")
metadata/_custom_type_script = "uid://0v2nidb8jsha"

[node name="play_off" type="Node" parent="on_interact/if_tv_off/if_false" node_paths=PackedStringArray("prev", "next")]
process_mode = 4
script = ExtResource("5_mta7w")
sound = ExtResource("12_xlbse")
wait_til_finished = false
prev = NodePath("../hide_eye")
next = NodePath("../mark_as_off")
metadata/_custom_type_script = "uid://vk574kc3l7av"

[node name="mark_as_off" type="Node" parent="on_interact/if_tv_off/if_false" node_paths=PackedStringArray("node", "prev")]
script = ExtResource("8_imcer")
node = NodePath("../../../../properties")
property_name = "properties"
property_info = {
"class_name": &"",
"hint": 23,
"hint_string": "4:;0:",
"name": "properties",
"type": 27,
"usage": 4102
}
property_value = Dictionary[String, Variant]({
"tv_on": true
})
new_value = Dictionary[String, Variant]({
"tv_on": false
})
prev = NodePath("../play_off")
metadata/_custom_type_script = "uid://0v2nidb8jsha"

[node name="properties" type="Node" parent="."]
script = ExtResource("7_imcer")
properties = Dictionary[String, Variant]({
"tv_on": false
})
skip_save = true
metadata/_custom_type_script = "uid://0li2ud4tbkf5"

[node name="looped_animation" type="AnimationPlayer" parent="."]
libraries = {
&"": SubResource("AnimationLibrary_v2ehy")
}
