[gd_scene load_steps=19 format=3 uid="uid://brssxovackb8b"]

[ext_resource type="Script" uid="uid://bxh774473av7t" path="res://src/systems/interaction/interactable.gd" id="1_wnphj"]
[ext_resource type="Script" uid="uid://bkadpjx8csm75" path="res://src/systems/sequencing/sequence/game/on_interact.gd" id="2_efn85"]
[ext_resource type="Script" uid="uid://dspsbq33tl0wa" path="res://src/systems/sequencing/event/game/invoke_game_event.gd" id="3_hs61y"]
[ext_resource type="Script" uid="uid://vk574kc3l7av" path="res://src/systems/sequencing/event/audio/play_sound.gd" id="4_t5c5s"]
[ext_resource type="Script" uid="uid://dyaslht461mw2" path="res://src/systems/sequencing/event/game/wait_seconds.gd" id="6_186um"]
[ext_resource type="Script" uid="uid://dlp3m6fps0h2j" path="res://src/systems/sequencing/event/animation/play_yield_animation.gd" id="7_hs61y"]
[ext_resource type="Script" uid="uid://c0ymap76lrhgr" path="res://src/systems/sequencing/event/scene/travel_to_scene.gd" id="7_l58dv"]
[ext_resource type="Script" uid="uid://ofyfa3d6ql28" path="res://src/systems/components/independent/spawn_point.gd" id="9_h48nh"]
[ext_resource type="Texture2D" uid="uid://cyr3omgnv06ig" path="res://src/levels/__ignore/doors/door_apartment.png" id="10_0egi2"]
[ext_resource type="Script" uid="uid://dlvvx5cthl4bp" path="res://src/systems/utils/spritesheet_formatter.gd" id="11_a8tey"]
[ext_resource type="Texture2D" uid="uid://05eixr261ttf" path="res://src/entities/shadow.png" id="12_biroj"]
[ext_resource type="AudioStream" uid="uid://u8dv45u7r3gh" path="res://src/audio/se/se_door_open.wav" id="14_hs61y"]

[sub_resource type="CanvasItemMaterial" id="CanvasItemMaterial_45h0u"]
blend_mode = 2

[sub_resource type="RectangleShape2D" id="RectangleShape2D_cv7t1"]
size = Vector2(16, 8)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_4eec8"]
size = Vector2(16, 16)

[sub_resource type="Animation" id="Animation_csl0k"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("renderer:progress")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [0]
}

[sub_resource type="Animation" id="Animation_t5c5s"]
resource_name = "open"
length = 0.8
step = 0.025
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("renderer:progress")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.05, 0.1, 0.15, 0.225, 0.3, 0.4),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1, 1),
"update": 1,
"values": [0, 1, 2, 3, 4, 5, 6]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_186um"]
_data = {
&"RESET": SubResource("Animation_csl0k"),
&"open": SubResource("Animation_t5c5s")
}

[node name="animated_door" type="Area2D" node_paths=PackedStringArray("rect")]
collision_layer = 2147483650
collision_mask = 2147483648
script = ExtResource("1_wnphj")
rect = NodePath("rect")
debug_colour = Color(0.9, 0, 0.7, 0.3)
metadata/_custom_type_script = "uid://bxh774473av7t"

[node name="on_interact" type="Node" parent="." node_paths=PackedStringArray("order", "front", "back")]
process_mode = 4
script = ExtResource("2_efn85")
order = [NodePath("request_cutscene_start"), NodePath("play_sound"), NodePath("play_animation"), NodePath("wait"), NodePath("travel_to_scene")]
front = NodePath("request_cutscene_start")
back = NodePath("travel_to_scene")

[node name="request_cutscene_start" type="Node" parent="on_interact" node_paths=PackedStringArray("next")]
script = ExtResource("3_hs61y")
event_id = "CUTSCENE_START_REQUEST"
next = NodePath("../play_sound")
metadata/_custom_type_script = "uid://dspsbq33tl0wa"

[node name="play_sound" type="Node" parent="on_interact" node_paths=PackedStringArray("prev", "next")]
process_mode = 4
script = ExtResource("4_t5c5s")
sound = ExtResource("14_hs61y")
pitch = 0.8
prev = NodePath("../request_cutscene_start")
next = NodePath("../play_animation")
metadata/_custom_type_script = "uid://0v2nidb8jsha"

[node name="play_animation" type="Node" parent="on_interact" node_paths=PackedStringArray("animator", "prev", "next")]
script = ExtResource("7_hs61y")
animator = NodePath("../../animation")
animation_path = &"open"
prev = NodePath("../play_sound")
next = NodePath("../wait")
metadata/_custom_type_script = "uid://0v2nidb8jsha"

[node name="wait" type="Node" parent="on_interact" node_paths=PackedStringArray("prev", "next")]
script = ExtResource("6_186um")
seconds = 0.5
prev = NodePath("../play_animation")
next = NodePath("../travel_to_scene")
metadata/_custom_type_script = "uid://0v2nidb8jsha"

[node name="travel_to_scene" type="Node" parent="on_interact" node_paths=PackedStringArray("spawn_point", "prev")]
process_mode = 4
script = ExtResource("7_l58dv")
spawn_point = NodePath("../../spawn_point")
prev = NodePath("../wait")
metadata/_custom_type_script = "uid://0v2nidb8jsha"

[node name="spawn_point" type="Node2D" parent="." node_paths=PackedStringArray("parent_instead_of_self")]
position = Vector2(0, 12)
script = ExtResource("9_h48nh")
parent_instead_of_self = NodePath("..")
metadata/_custom_type_script = "uid://ofyfa3d6ql28"

[node name="renderer" type="Sprite2D" parent="."]
texture = ExtResource("10_0egi2")
hframes = 7
script = ExtResource("11_a8tey")
frame_dimensions = Vector2i(17, 30)
frame_h_count = 7

[node name="shadow_renderer" type="Sprite2D" parent="renderer"]
show_behind_parent = true
material = SubResource("CanvasItemMaterial_45h0u")
position = Vector2(0, -8)
texture = ExtResource("12_biroj")

[node name="coll" type="StaticBody2D" parent="."]
position = Vector2(0, 12)

[node name="shape" type="CollisionShape2D" parent="coll"]
shape = SubResource("RectangleShape2D_cv7t1")

[node name="rect" type="CollisionShape2D" parent="."]
shape = SubResource("RectangleShape2D_4eec8")
debug_color = Color(0.9, 0, 0.7, 0.3)

[node name="animation" type="AnimationPlayer" parent="."]
libraries = {
&"": SubResource("AnimationLibrary_186um")
}
